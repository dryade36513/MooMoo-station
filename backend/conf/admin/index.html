<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MooMoo Station ÁÆ°ÁêÜÂæåËá∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
        }

        .admin-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            padding: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: relative;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: #ecf0f1;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin: 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 16px;
            position: relative;
        }

        .nav-link:hover {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .nav-link.active {
            background: #3498db;
            color: white;
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .nav-arrow {
            margin-left: auto;
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .has-submenu .nav-arrow {
            transform: rotate(-90deg);
        }

        .has-submenu.expanded .nav-arrow {
            transform: rotate(0deg);
        }

        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            background: rgba(0, 0, 0, 0.1);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .has-submenu.expanded .submenu {
            max-height: 200px;
        }

        .submenu-item {
            margin: 0;
        }

        .submenu-link {
            display: flex;
            align-items: center;
            padding: 10px 20px 10px 52px;
            color: #95a5a6;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 15px;
        }

        .submenu-link:hover {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .submenu-link.active {
            background: #3498db;
            color: white;
        }

        .submenu-icon {
            margin-right: 8px;
            font-size: 14px;
            width: 16px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .page-header {
            margin: 0;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 5px 0;
        }

        .page-description {
            color: #6c757d;
            font-size: 16px;
            margin: 0;
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .content-frame {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            min-height: calc(100vh - 200px);
            overflow: hidden;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            color: #6c757d;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 25px;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            color: rgba(255,255,255,0.8);
            font-size: 16px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 16px;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .top-bar {
                padding: 15px 20px;
            }
        }

        .welcome-content {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-icon {
            font-size: 64px;
            color: #667eea;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .welcome-text {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
            /* ÈÄèÊòéÊµÆÂ±§Ê®£ÂºèÔºàÂêà‰ΩµËá™ config.htmlÔºâ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001; /* ‰øùË≠âÈ´òÊñºÊâÄÊúâÊ®°ÊÖãÂ±§Ôºà9999Ôºâ */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .overlay-content {
            background: white;
            padding: 24px 32px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .overlay.show .overlay-content {
            transform: scale(1);
        }

        .overlay-content.success {
            border-left: 4px solid #16a34a;
            color: #16a34a;
        }

        .overlay-content.error {
            border-left: 4px solid #dc2626;
            color: #dc2626;
        }

        .overlay-content .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .overlay-content.success .icon::before {
            content: "‚úì";
        }

        .overlay-content.error .icon::before {
            content: "‚úó";
        }

        .overlay-content .message {
            font-size: 16px;
            font-weight: 500;
            line-height: 1.5;
        }

        .action-buttons {
            margin-top: 30px;
            padding-top: 24px;
            border-top: 2px solid #f1f3f4;
            text-align: center;
        }
</style>
</head>
<body>
    <div class="admin-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="3" width="7" height="7" rx="1" fill="#4A90E2"/>
                            <rect x="14" y="3" width="7" height="7" rx="1" fill="#4A90E2"/>
                            <rect x="3" y="14" width="7" height="7" rx="1" fill="#4A90E2"/>
                            <rect x="14" y="14" width="7" height="7" rx="1" fill="#4A90E2"/>
                        </svg>
                    </div>
                    <span class="logo-text">MooMoo Station</span>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item has-submenu">
                    <a href="#" class="nav-link" data-page="config">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        ÈÖçÁΩÆÁÆ°ÁêÜ
                        <span class="nav-arrow">‚ñº</span>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="#" class="submenu-link active" data-page="basic-config">
                                <span class="submenu-icon">üîß</span>
                                Âü∫Á§éÈÖçÁΩÆ
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-page="model-management">
                                <span class="submenu-icon">ü§ñ</span>
                                Ê®°ÂûãÁÆ°ÁêÜ
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-page="knowledge-config">
                                <span class="submenu-icon">üìö</span>
                                Áü•Ë≠òÂ∫´ÈÖçÁΩÆ
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">üë§</div>
                    <div>
                        <div id="userName">ÁÆ°ÁêÜÂì°</div>
                        <div id="userStatus" style="font-size: 12px; opacity: 0.7;">Âú®Á∑ö</div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <div class="top-bar" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title" id="pageTitle">Âü∫Á§éÈÖçÁΩÆ</h1>
                    <p class="page-description" id="pageDescription">ÁÆ°ÁêÜÂíåÈÖçÁΩÆÂü∫Á§éÈÖçÁΩÆ</p>
                </div>
            </div>

            <div class="content-area">
                <div class="content-frame">
                    <div id="pageContent">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <span>${t('loading')}</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ÂÖ®Â±ÄÈÄèÊòéÊµÆÂ±§Ôºà‰æÜËá™ config.htmlÔºâ -->
    <div id="overlay" class="overlay">
        <div id="overlayContent" class="overlay-content">
            <div class="icon"></div>
            <div class="message" id="overlayMessage"></div>
        </div>
    </div>

    <script>
        // i18nÔºàÁ∞°ÊòìÂ≠óÂÖ∏ + ÊáâÁî®ÂáΩÊï∏Ôºâ
        const I18N = {
            'zh-CN': {
                'nav.config': 'ÈÖçÁΩÆÁÆ°ÁêÜ',
                'nav.basic': 'Âü∫Á§éÈÖçÁΩÆ',
                'nav.model': 'Ê®°ÂûãÁÆ°ÁêÜ',
                'nav.knowledge': 'Áü•Ë≠òÂ∫´ÈÖçÁΩÆ',

                'page.basic.title': 'Âü∫Á§éÈÖçÁΩÆ',
                'page.basic.desc': 'Á≥ªÁµ±Âü∫Á§éÈÖçÁΩÆÁÆ°ÁêÜ',
                'page.model.title': 'Ê®°ÂûãÁÆ°ÁêÜ',
                'page.model.desc': 'AIÊ®°ÂûãÈÖçÁΩÆÂíåÁÆ°ÁêÜ',
                'page.knowledge.title': 'Áü•Ë≠òÂ∫´ÈÖçÁΩÆ',
                'page.knowledge.desc': 'Áü•Ë≠òÂ∫´Ë®≠ÁΩÆÂíåÁÆ°ÁêÜ',
                'page.default.title': 'È†ÅÈù¢',
                'page.default.desc': 'È†ÅÈù¢ÊèèËø∞',
                'page.contentArea': 'ÈÄôË£èÊòØ{title}È†ÅÈù¢ÁöÑÂÖßÂÆπÂçÄÂüü„ÄÇ',

                'loading': 'Âä†Ëºâ‰∏≠...',
                'status.online': 'Âú®Á∑ö',
                'error.generic': 'ÁôºÁîüÈåØË™§',
                'success.generic': 'Êìç‰ΩúÊàêÂäü',

                'quick.title': 'Âø´ÈÄüÊìç‰Ωú',
                'quick.new': 'Êñ∞Âª∫',
                'quick.import': 'Â∞éÂÖ•',
                'quick.export': 'Â∞éÂá∫',
                'quick.settings': 'Ë®≠ÁΩÆ',

                'feature.module1': 'ÂäüËÉΩÊ®°Â°ä 1',
                'feature.module2': 'ÂäüËÉΩÊ®°Â°ä 2',
                'feature.module3': 'ÂäüËÉΩÊ®°Â°ä 3',
                'feature.desc': 'Áõ∏ÈóúÂäüËÉΩÊèèËø∞ÂíåÊìç‰ΩúÂÖ•Âè£',

                'user.admin': 'ÁÆ°ÁêÜÂì°',

                'basic.loading': 'Ê≠£Âú®Âä†ËºâÈÖçÁΩÆ...',
                'basic.label.admin_emails': 'ÁÆ°ÁêÜÂì°ÈÉµÁÆ±',
                'basic.placeholder.email_input': 'Ëº∏ÂÖ•ÈÉµÁÆ±ÔºåÊåâÂõûËªäÊ∑ªÂä†',
                'basic.placeholder.coze_api_token': 'Ëº∏ÂÖ•ÊÇ®ÁöÑ Coze API Token',
                'basic.help.coze_api_token_apply': 'ÂâçÂæÄÊ≠§ÈèàÊé•Áî≥Ë´ã Coze API Token',
                'basic.label.enable_coze_saas': 'ÂïìÁî® Coze SaaS Êèí‰ª∂',
                'basic.label.disable_user_registration': 'Á¶ÅÊ≠¢Áî®Êà∂Ë®ªÂÜä',
                'basic.label.whitelist_emails': 'ÂÖÅË®±Ë®ªÂÜäÁöÑÁôΩÂêçÂñÆÈÉµÁÆ±',
                'basic.help.whitelist': 'Áï∂Á¶ÅÊ≠¢Áî®Êà∂Ë®ªÂÜäÊôÇÔºåÂè™ÊúâÁôΩÂêçÂñÆ‰∏≠ÁöÑÈÉµÁÆ±ÊâçËÉΩË®ªÂÜä',
                'basic.label.python_env': 'Python ‰ª£Á¢ºÈÅãË°åÁí∞Â¢É',
                'basic.help.local_risk': 'Local ÊúâË¢´ÊîªÊìäÁöÑÂÆâÂÖ®È¢®Èö™ÔºåÁîüÁî¢Áí∞Â¢ÉÊÖéÁî®ÔºåÂª∫Ë≠∞‰ΩøÁî® Sandbox Ê®°Âºè„ÄÇ',
                'basic.sandbox.title': 'Sandbox ÈÖçÁΩÆ',
                'basic.label.allow_env': 'ÂÖÅË®±ËÆÄÂèñÁöÑÁí∞Â¢ÉËÆäÈáè',
                'basic.label.allow_read': 'ÂÖÅË®±ËÆÄÂèñÁöÑÁõÆÈåÑÂú∞ÂùÄ',
                'basic.label.allow_write': 'ÂÖÅË®±ÂØ´ÁöÑÁõÆÈåÑÂú∞ÂùÄ',
                'basic.label.allow_run': 'ÂÖÅË®±Âü∑Ë°åÁöÑÂëΩ‰ª§',
                'basic.label.allow_net': 'ÂÖÅË®±Ë®™ÂïèÁöÑÁ∂≤Áµ°Âú∞ÂùÄ',
                'basic.label.allow_ffi': 'ÂÖÅË®±Ë®™ÂïèÁöÑ lib Â∫´',
                'basic.label.node_modules_dir': 'Node Modules ÁõÆÈåÑÂú∞ÂùÄ',
                'basic.label.timeout_seconds': '‰ª£Á¢ºÂü∑Ë°åË∂ÖÊôÇÊôÇÈñìÔºàÁßíÔºâ',
                'basic.label.memory_limit_mb': 'ÂÖßÂ≠òÈôêÂà∂ÔºàMBÔºâ',

                'server.title': 'ÊúçÂãôÂô®ÈÖçÁΩÆ',
                'server.host.label': 'ÊúçÂãôÂô®‰∏ªÊ©üÂú∞ÂùÄ',
                'server.host.help': 'Ê†ºÂºèÔºöhttp(s)://‰∏ªÊ©üÂêç:Á´ØÂè£Ëôü , oauth ÈëëÊ¨äÊúÉÁî®Âà∞',

                'btn.save': '‰øùÂ≠òÈÖçÁΩÆ',
                'btn.reload': 'ÈáçÊñ∞Âä†Ëºâ',

                'error.invalid_email': 'Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈÉµÁÆ±Âú∞ÂùÄ',
                'error.email_exists': 'Ë©≤ÈÉµÁÆ±Â∑≤Â≠òÂú®',
                'error.admin_email_required': 'Ë´ãËá≥Â∞ëË®≠ÁΩÆ‰∏ÄÂÄãÁÆ°ÁêÜÂì°ÈÉµÁÆ±',
                'error.server_host_required': 'Ë´ãÂ°´ÂØ´ÊúçÂãôÂô®‰∏ªÊ©üÂú∞ÂùÄ',
                'error.invalid_admin_emails': 'ÁÆ°ÁêÜÂì°ÈÉµÁÆ±Â≠òÂú®ÁÑ°ÊïàÂú∞ÂùÄÔºö{list}',
                'error.invalid_whitelist_emails': 'ÁôΩÂêçÂñÆÈÉµÁÆ±Â≠òÂú®ÁÑ°ÊïàÂú∞ÂùÄÔºö{list}',
                'error.save_failed': '‰øùÂ≠òÂ§±Êïó',
                'error.save_failed_json': '‰øùÂ≠òÂ§±ÊïóÔºöË´ãÊ™¢Êü•ÊúçÂãôÊòØÂê¶ÂïìÂãï‰∏¶ËøîÂõûÊúâÊïà JSON',
                'error.load_failed_empty': 'Âä†ËºâÂ§±ÊïóÔºöËøîÂõûÊï∏ÊìöÁà≤Á©∫',
                'error.load_failed_json': 'Âä†ËºâÂ§±ÊïóÔºöË´ãÊ™¢Êü•ÊúçÂãôÊòØÂê¶ÂïìÂãï‰∏¶ËøîÂõûÊúâÊïà JSON',
                'success.saved': '‰øùÂ≠òÊàêÂäü',
                'success.saved_restart_required': '‰øùÂ≠òÊàêÂäüÔºåÊúçÂãôÈúÄË¶ÅÈáçÂïìÁîüÊïà',
                'overlay.saving': 'Ê≠£Âú®‰øùÂ≠òÈÖçÁΩÆ...',
                'error.missing_required': 'Ë´ãÂ°´ÂØ´ÂøÖÂ°´È†ÖÔºö{list}',
                'error.api_error': 'Êé•Âè£ËøîÂõûÈåØË™§',
                'error.save_failed_reason': '‰øùÂ≠òÂ§±Êïó: {reason}',
                'page.manage_config': 'ÁÆ°ÁêÜÂíåÈÖçÁΩÆ {title}',
                'page.empty': 'È†ÅÈù¢ÂÖßÂÆπÁà≤Á©∫',
                'help.title': 'Âπ´Âä©ÊñáÊ™î',
                'help.quickstart.title': 'üöÄ Âø´ÈÄüÈñãÂßã',
                'help.quickstart.step1': 'È¶ñÂÖàÈÖçÁΩÆÂü∫Á§éË®≠ÁΩÆÔºåÂåÖÊã¨ API ÂØÜÈë∞ÂíåÁ≥ªÁµ±ÂèÉÊï∏',
                'help.quickstart.step2': 'Ê∑ªÂä†ÂíåÈÖçÁΩÆ AI Ê®°Âûã',
                'help.quickstart.step3': 'ÂâµÂª∫Áü•Ë≠òÂ∫´‰∏¶‰∏äÂÇ≥ÊñáÊ™î',
                'help.quickstart.step4': 'ÈñãÂßã‰ΩøÁî®ÊÇ®ÁöÑ AI Âä©Êâã',
                'help.features.title': 'üìö ÂäüËÉΩË™™Êòé',
                'help.features.basic': 'Âü∫Á§éÈÖçÁΩÆÔºöÁ≥ªÁµ±Ë®≠ÁΩÆ„ÄÅAPI ÈÖçÁΩÆ„ÄÅÂÆâÂÖ®Ë®≠ÁΩÆ',
                'help.features.model': 'Ê®°ÂûãÁÆ°ÁêÜÔºöÊ∑ªÂä†„ÄÅÁ∑®ËºØ„ÄÅÂà™Èô§ AI Ê®°Âûã',
                'help.features.kb': 'Áü•Ë≠òÂ∫´ÔºöÊñáÊ™î‰∏äÂÇ≥„ÄÅÁ¥¢ÂºïÁÆ°ÁêÜ„ÄÅÊ™¢Á¥¢ÈÖçÁΩÆ',
                'help.support.title': 'üîß ÊäÄË°ìÊîØÊåÅ',
                'help.support.contact': 'Â¶ÇÊûúÊÇ®ÈÅáÂà∞ÂïèÈ°åÔºåË´ãËÅØÁπ´ÊäÄË°ìÊîØÊåÅÂúòÈöä',
                'help.support.email': 'üìß ÈÉµÁÆ±: {email}',
                'help.support.phone': 'üìû ÈõªË©±: {phone}',
                'export.success': 'ÈÖçÁΩÆÊñá‰ª∂Â∑≤Â∞éÂá∫ÔºÅ',
                'error.page_load_failed_reason': 'È†ÅÈù¢Âä†ËºâÂ§±Êïó: {reason}',

                // ÈÄöÁî®
                'common.cancel': 'ÂèñÊ∂à',
                'common.save': '‰øùÂ≠ò',
                'common.delete': 'Âà™Èô§',
                'common.enabled': 'ÂïìÁî®',
                'common.disabled': 'ÂÅúÁî®',
                'common.on': 'ÈñãÂïì',
                'common.off': 'ÈóúÈñâ',
                'common.saving': '‰øùÂ≠ò‰∏≠...',
                'common.not_configured': 'Êú™ÈÖçÁΩÆ',
                'common.unknown_error': 'Êú™Áü•ÈåØË™§',

                // Ê®°ÂûãÁÆ°ÁêÜ
                'model.list.title': 'Ê®°ÂûãÂàóË°®',
                'model.provider.count': 'Êèê‰æõÊñπÊï∏ÈáèÔºö{count}',
                'model.provider.model_count': 'Ê®°ÂûãÊï∏ÈáèÔºö{count}',
                'model.actions.add': 'Ê∑ªÂä†Ê®°Âûã',
                'model.provider.unnamed': 'Êú™ÂëΩÂêçÊèê‰æõÊñπ',
                'model.provider.unknown': 'Êú™Áü•Êèê‰æõÊñπ',
                'model.unnamed': 'Êú™ÂëΩÂêçÊ®°Âûã',

                'model.field.id': 'ID',
                'model.field.model': 'Model',
                'model.field.api_key': 'API Key',
                'model.field.base64_url': 'Base64URL',
                'model.field.region': 'Region',
                'model.field.backend': 'Backend',
                'model.field.project': 'Project',
                'model.field.location': 'Location',
                'model.field.azure': 'By Azure',
                'model.field.api_version': 'API Version',
                'model.field.endpoint': 'Êé•Âè£Âú∞ÂùÄ',
                'model.field.thinking_type': 'Thinking Type',
                'model.thinking_type.default': 'Default',
                'model.thinking_type.enable': 'Enable',
                'model.thinking_type.disable': 'Disable',
                'model.thinking_type.auto': 'Auto',

                'model.error.load_list_failed': 'Âä†ËºâÊ®°ÂûãÂàóË°®Â§±Êïó',
                'model.error.render_page_failed': 'Ê∏≤ÊüìÊ®°ÂûãÈ†ÅÈù¢Â§±Êïó',
                'model.error.delete_missing_id': 'Âà™Èô§Ê®°ÂûãÂ§±Êïó: Áº∫Â∞ëÊ®°ÂûãID',
                'model.confirm.delete': 'Á¢∫Ë™çÂà™Èô§Ë©≤Ê®°ÂûãÔºüÂà™Èô§Âæå‰∏çÂèØÊÅ¢Âæ©',
                'model.error.delete_invalid_json': 'Âà™Èô§Ê®°ÂûãÂ§±Êïó: ËøîÂõûÁµêÊûú‰∏çÊòØÊúâÊïà JSON',
                'model.error.delete_failed': 'Âà™Èô§Ê®°ÂûãÂ§±Êïó',
                'model.error.open_modal_failed': 'ÁÑ°Ê≥ïÊâìÈñãÊ∑ªÂä†Ê®°ÂûãË°®ÂñÆÔºöÁµÑ‰ª∂Êú™Ê∏≤Êüì',
                'model.error.provider_unrecognized': 'ÁÑ°Ê≥ïË≠òÂà•Ê®°ÂûãÊèê‰æõÊñπÔºåË´ãÂæûÊèê‰æõÊñπÂç°ÁâáÈªûÊìä‚ÄúÊ∑ªÂä†Ê®°Âûã‚Äù„ÄÇ',
                'model.error.missing_required_with_api': 'Ë´ãÂ°´ÂØ´ÂøÖÂ°´È†ÖÔºöÊ®°ÂûãÂ±ïÁ§∫ÂêçÁ®±„ÄÅmodel„ÄÅapi_key',
                'model.error.missing_required': 'Ë´ãÂ°´ÂØ´ÂøÖÂ°´È†ÖÔºöÊ®°ÂûãÂ±ïÁ§∫ÂêçÁ®±„ÄÅmodel',
                'model.error.create_read_failed': 'ÂâµÂª∫Ê®°ÂûãÂ§±Êïó: ÁÑ°Ê≥ïËÆÄÂèñÈüøÊáâÂÖßÂÆπ',
                'model.create.success': 'ÂâµÂª∫ÊàêÂäü',
                'model.error.create_failed': 'ÂâµÂª∫Ê®°ÂûãÂ§±Êïó',

                // Ê∑ªÂä†Ê®°ÂûãÂΩàÁ™ó
                'model.modal.add.title': 'Ê∑ªÂä†Ê®°Âûã',
                'model.modal.display_name.label': 'Ê®°ÂûãÈ°ØÁ§∫ÂêçÁ®±',
                'model.modal.display_name.placeholder': '‰æãÂ¶ÇÔºöDoubao Seed 1.6',
                'model.modal.model.label': 'Model',
                'model.modal.model.placeholder': '‰æãÂ¶ÇÔºödoubao-seed-1-6-250615',
                'model.modal.api_key.label': 'API Key',
                'model.modal.api_key.placeholder': 'ÂØÜÈë∞',
                'model.modal.base_url.label': 'Base URL',
                'model.modal.base_url.placeholder': 'ÈÅ∏Â°´',
                'model.modal.enable_base64_url.label': 'ÂïìÁî® Base64 URL',
                'model.modal.enable_base64_url.help': '‰ΩøÁî® base64 Á∑®Á¢ºÂúñÁâá„ÄÅÊñá‰ª∂„ÄÅÈü≥È†ª„ÄÅË¶ñÈ†ª URL Áµ¶Ê®°Âûã',
                'model.modal.ark_region.label': 'RegionÔºàArkÔºâ',
                'model.modal.ark_region.placeholder': 'ÈÅ∏Â°´Ôºå‰æãÂ¶ÇÔºöcn-beijing',
                'model.modal.azure.label': '‰ΩøÁî® Azure',
                'model.modal.azure.help': 'OpenAI Ë®≠ÁΩÆÔºöÂãæÈÅ∏Ë°®Á§∫ÈÄöÈÅé Azure ‰ΩøÁî®',
                'model.modal.openai_api_version.label': 'OpenAI API Version',
                'model.modal.openai_api_version.placeholder': 'ÈÅ∏Â°´Ôºå‰æãÂ¶ÇÔºö2024-06-01',
                'model.modal.gemini_backend.label': 'Backend',
                'model.modal.gemini_backend.unspecified': 'Êú™ÊåáÂÆö',
                'model.modal.gemini_backend.gemini_api': 'Gemini API',
                'model.modal.gemini_backend.vertex_ai': 'Vertex AI',
                'model.modal.gemini_project.label': 'Project',
                'model.modal.gemini_project.placeholder': 'ÈÅ∏Â°´Ôºå‰æãÂ¶ÇÔºömy-project',
                'model.modal.gemini_location.label': 'Location',
                'model.modal.gemini_location.placeholder': 'ÈÅ∏Â°´Ôºå‰æãÂ¶ÇÔºöus-central1',
                'model.modal.thinking_type.label': 'Thinking Type',
                'model.modal.thinking_type.enable': 'Enable',
                'model.modal.thinking_type.disable': 'Disable',
                'model.modal.thinking_type.auto': 'Auto',
                
                // Áü•Ë≠òÂ∫´ÈÖçÁΩÆ
                'knowledge.error.load_failed_json': 'Âä†ËºâÁü•Ë≠òÂ∫´ÈÖçÁΩÆÂ§±Êïó: ËøîÂõûÁµêÊûú‰∏çÊòØÊúâÊïà JSON',
                'knowledge.error.load_failed_msg': 'Âä†ËºâÁü•Ë≠òÂ∫´ÈÖçÁΩÆÂ§±Êïó: {msg}',
                'knowledge.error.load_failed_empty': 'Âä†ËºâÁü•Ë≠òÂ∫´ÈÖçÁΩÆÂ§±Êïó: ËøîÂõûÊï∏ÊìöÁà≤Á©∫',
                'knowledge.error.load_failed': 'Âä†ËºâÁü•Ë≠òÂ∫´ÈÖçÁΩÆÂ§±Êïó',
                'knowledge.error.load_failed_reason': 'Âä†ËºâÁü•Ë≠òÂ∫´ÈÖçÁΩÆÂ§±Êïó: {reason}',
                'knowledge.log.local_preview_no_demo': 'Êú¨Âú∞È†êË¶ΩÔºö‰∏ç‰ΩøÁî®Á§∫‰æãÊï∏Êìö',
                'knowledge.section.embedding': 'Embedding ÈÖçÁΩÆ',
                'knowledge.connection': '{name} ÈÄ£Êé•',
                'knowledge.section.rerank': 'Rerank ÈÖçÁΩÆ',
                'knowledge.section.ocr': 'OCR ÈÖçÁΩÆ',
                'knowledge.section.parser': 'Parser ÈÖçÁΩÆ',
                'knowledge.section.builtin_model': 'Áü•Ë≠òÂ∫´ÂÖßÁΩÆÊ®°ÂûãÈÖçÁΩÆ',
                'knowledge.label.choose_builtin_model': 'ÈÅ∏ÊìáÂÖßÁΩÆÊ®°Âûã',
                'knowledge.placeholder.select_model': 'Ë´ãÈÅ∏ÊìáÊ®°Âûã',
                'knowledge.loading.model_list': 'Ê≠£Âú®Âä†ËºâÊ®°ÂûãÂàóË°®...',
                'knowledge.empty.model_list': 'Êú™Áç≤ÂèñÂà∞Ê®°ÂûãÂàóË°®',
                'knowledge.placeholder.model_fallback': 'Ê®°Âûã #{id}',
                'knowledge.tip.setup_model_first': 'Ë´ãÂÖàÈÖçÁΩÆÊ®°Âûã',
                'knowledge.error.model_list_load_failed': 'Âä†ËºâÊ®°ÂûãÂàóË°®Â§±Êïó',
                'knowledge.error.render_failed': 'Ê∏≤ÊüìÁü•Ë≠òÂ∫´ÈÖçÁΩÆÂ§±Êïó',
                'knowledge.error.save_failed': '‰øùÂ≠òÈÖçÁΩÆÂ§±Êïó'
            },
            'en-US': {
                'nav.config': 'Configuration',
                'nav.basic': 'Basic Config',
                'nav.model': 'Model Management',
                'nav.knowledge': 'Knowledge Config',

                'page.basic.title': 'Basic Config',
                'page.basic.desc': 'System basic configuration',
                'page.model.title': 'Model Management',
                'page.model.desc': 'AI model configuration and management',
                'page.knowledge.title': 'Knowledge Config',
                'page.knowledge.desc': 'Knowledge base settings and management',
                'page.default.title': 'Page',
                'page.default.desc': 'Page Description',
                'page.contentArea': 'This is the content area of {title}.',

                'loading': 'Loading...',
                'status.online': 'Online',
                'error.generic': 'Error occurred',
                'success.generic': 'Success',

                'quick.title': 'Quick Actions',
                'quick.new': 'New',
                'quick.import': 'Import',
                'quick.export': 'Export',
                'quick.settings': 'Settings',

                'feature.module1': 'Feature Module 1',
                'feature.module2': 'Feature Module 2',
                'feature.module3': 'Feature Module 3',
                'feature.desc': 'Feature description and actions',

                'user.admin': 'Admin',

                'basic.loading': 'Loading configuration...',
                'basic.label.admin_emails': 'Admin Emails',
                'basic.placeholder.email_input': 'Type email, press Enter to add',
                'basic.placeholder.coze_api_token': 'Enter your Coze API Token',
                'basic.help.coze_api_token_apply': 'Apply for a Coze API Token here',
                'basic.label.enable_coze_saas': 'Enable Coze SaaS plugin',
                'basic.label.disable_user_registration': 'Disable user registration',
                'basic.label.whitelist_emails': 'Whitelist emails allowed to register',
                'basic.help.whitelist': 'When registration is disabled, only whitelisted emails can register.',
                'basic.label.python_env': 'Python Execution Environment',
                'basic.help.local_risk': 'Local has security risks; use Sandbox in production.',
                'basic.sandbox.title': 'Sandbox Config',
                'basic.label.allow_env': 'Allowed environment variables',
                'basic.label.allow_read': 'Readable directories',
                'basic.label.allow_write': 'Writable directories',
                'basic.label.allow_run': 'Allowed commands',
                'basic.label.allow_net': 'Allowed network addresses',
                'basic.label.allow_ffi': 'Allowed lib (FFI)',
                'basic.label.node_modules_dir': 'Node Modules directory',
                'basic.label.timeout_seconds': 'Code timeout (seconds)',
                'basic.label.memory_limit_mb': 'Memory limit (MB)',

                'server.title': 'Server Configuration',
                'server.host.label': 'Server host address',
                'server.host.help': 'Format: http(s)://hostname:port , used by oauth auth',

                'btn.save': 'Save Config',
                'btn.reload': 'Reload',

                'error.invalid_email': 'Please enter a valid email address',
                'error.email_exists': 'This email already exists',
                'error.admin_email_required': 'Please set at least one admin email',
                'error.server_host_required': 'Please provide the server host address',
                'error.invalid_admin_emails': 'Invalid admin emails: {list}',
                'error.invalid_whitelist_emails': 'Invalid whitelist emails: {list}',
                'error.save_failed': 'Save failed',
                'error.save_failed_json': 'Save failed: check the service and JSON response',
                'error.load_failed_empty': 'Load failed: empty response data',
                'error.load_failed_json': 'Load failed: check the service and JSON response',
                'success.saved': 'Saved successfully',
                'success.saved_restart_required': 'Saved successfully. Restart the service to take effect',
                'overlay.saving': 'Saving configuration...',
                'error.missing_required': 'Please fill required fields: {list}',
                'error.api_error': 'API returned error',
                'error.save_failed_reason': 'Save failed: {reason}',
                'page.manage_config': 'Manage and configure {title}',
                'page.empty': 'Page content is empty',
                'help.title': 'Help',
                'help.quickstart.title': 'üöÄ Quick Start',
                'help.quickstart.step1': 'Configure basic settings including API keys and system parameters',
                'help.quickstart.step2': 'Add and configure AI models',
                'help.quickstart.step3': 'Create a knowledge base and upload documents',
                'help.quickstart.step4': 'Start using your AI assistant',
                'help.features.title': 'üìö Feature Overview',
                'help.features.basic': 'Basic Config: system settings, API config, security settings',
                'help.features.model': 'Model Management: add, edit, and delete AI models',
                'help.features.kb': 'Knowledge Base: document upload, indexing, retrieval config',
                'help.support.title': 'üîß Technical Support',
                'help.support.contact': 'If you encounter issues, contact the support team',
                'help.support.email': 'üìß Email: {email}',
                'help.support.phone': 'üìû Phone: {phone}',
                'export.success': 'Configuration file exported!',
                'error.page_load_failed_reason': 'Page load failed: {reason}',

                // Common
                'common.cancel': 'Cancel',
                'common.save': 'Save',
                'common.delete': 'Delete',
                'common.enabled': 'Enabled',
                'common.disabled': 'Disabled',
                'common.on': 'On',
                'common.off': 'Off',
                'common.saving': 'Saving...',
                'common.not_configured': 'Not configured',
                'common.unknown_error': 'Unknown error',

                // Model Management
                'model.list.title': 'Model List',
                'model.provider.count': 'Providers: {count}',
                'model.provider.model_count': 'Model count: {count}',
                'model.actions.add': 'Add Model',
                'model.provider.unnamed': 'Unnamed provider',
                'model.provider.unknown': 'Unknown provider',
                'model.unnamed': 'Unnamed model',

                'model.field.id': 'ID',
                'model.field.model': 'Model',
                'model.field.api_key': 'API Key',
                'model.field.base64_url': 'Base64URL',
                'model.field.region': 'Region',
                'model.field.backend': 'Backend',
                'model.field.project': 'Project',
                'model.field.location': 'Location',
                'model.field.azure': 'By Azure',
                'model.field.api_version': 'API Version',
                'model.field.endpoint': 'Endpoint',
                'model.field.thinking_type': 'Thinking Type',
                'model.thinking_type.default': 'Default',
                'model.thinking_type.enable': 'Enable',
                'model.thinking_type.disable': 'Disable',
                'model.thinking_type.auto': 'Auto',

                'model.error.load_list_failed': 'Failed to load model list',
                'model.error.render_page_failed': 'Failed to render model page',
                'model.error.delete_missing_id': 'Delete model failed: missing model ID',
                'model.confirm.delete': 'Delete this model? This cannot be undone',
                'model.error.delete_invalid_json': 'Delete model failed: invalid JSON response',
                'model.error.delete_failed': 'Delete model failed',
                'model.error.open_modal_failed': 'Cannot open add-model form: component not rendered',
                'model.error.provider_unrecognized': 'Unrecognized provider; click ‚ÄúAdd Model‚Äù on a provider card.',
                'model.error.missing_required_with_api': 'Please fill required: display name, model, api_key',
                'model.error.missing_required': 'Please fill required: display name, model',
                'model.error.create_read_failed': 'Create model failed: cannot read response',
                'model.create.success': 'Created successfully',
                'model.error.create_failed': 'Create model failed',

                // Add Model Modal
                'model.modal.add.title': 'Add Model',
                'model.modal.display_name.label': 'Display Name',
                'model.modal.display_name.placeholder': 'e.g., Doubao Seed 1.6',
                'model.modal.model.label': 'Model',
                'model.modal.model.placeholder': 'e.g., doubao-seed-1-6-250615',
                'model.modal.api_key.label': 'API Key',
                'model.modal.api_key.placeholder': 'Secret',
                'model.modal.base_url.label': 'Base URL',
                'model.modal.base_url.placeholder': 'Optional',
                'model.modal.enable_base64_url.label': 'Enable Base64 URL',
                'model.modal.enable_base64_url.help': 'Use base64-encoded URLs for images, files, audio, video',
                'model.modal.ark_region.label': 'Region (Ark)',
                'model.modal.ark_region.placeholder': 'Optional, e.g., cn-beijing',
                'model.modal.azure.label': 'Use Azure',
                'model.modal.azure.help': 'OpenAI settings: check to use via Azure',
                'model.modal.openai_api_version.label': 'OpenAI API Version',
                'model.modal.openai_api_version.placeholder': 'Optional, e.g., 2024-06-01',
                'model.modal.gemini_backend.label': 'Backend',
                'model.modal.gemini_backend.unspecified': 'Unspecified',
                'model.modal.gemini_backend.gemini_api': 'Gemini API',
                'model.modal.gemini_backend.vertex_ai': 'Vertex AI',
                'model.modal.gemini_project.label': 'Project',
                'model.modal.gemini_project.placeholder': 'Optional, e.g., my-project',
                'model.modal.gemini_location.label': 'Location',
                'model.modal.gemini_location.placeholder': 'Optional, e.g., us-central1',
                'model.modal.thinking_type.label': 'Thinking Type',
                'model.modal.thinking_type.enable': 'Enable',
                'model.modal.thinking_type.disable': 'Disable',
                'model.modal.thinking_type.auto': 'Auto',
                
                // Knowledge Config
                'knowledge.error.load_failed_json': 'Load knowledge config failed: invalid JSON response',
                'knowledge.error.load_failed_msg': 'Load knowledge config failed: {msg}',
                'knowledge.error.load_failed_empty': 'Load knowledge config failed: empty response data',
                'knowledge.error.load_failed': 'Load knowledge config failed',
                'knowledge.error.load_failed_reason': 'Load knowledge config failed: {reason}',
                'knowledge.log.local_preview_no_demo': 'Local preview: no demo data used',
                'knowledge.section.embedding': 'Embedding Config',
                'knowledge.connection': '{name} Connection',
                'knowledge.section.rerank': 'Rerank Config',
                'knowledge.section.ocr': 'OCR Config',
                'knowledge.section.parser': 'Parser Config',
                'knowledge.section.builtin_model': 'Knowledge Built-in Model Config',
                'knowledge.label.choose_builtin_model': 'Choose Built-in Model',
                'knowledge.placeholder.select_model': 'Please select a model',
                'knowledge.loading.model_list': 'Loading model list...',
                'knowledge.empty.model_list': 'No model list retrieved',
                'knowledge.placeholder.model_fallback': 'Model #{id}',
                'knowledge.tip.setup_model_first': 'Please configure models first',
                'knowledge.error.model_list_load_failed': 'Failed to load model list',
                'knowledge.error.render_failed': 'Render knowledge config failed',
                'knowledge.error.save_failed': 'Failed to save config'
            },
        };

        let currentLocale = 'zh-CN';
        function t(key, vars) {
            const dict = I18N[currentLocale] || I18N['zh-CN'];
            let text = dict[key] || I18N['zh-CN'][key] || key;
            if (vars && typeof vars === 'object') {
                text = String(text).replace(/\{(\w+)\}/g, (_, k) => (vars[k] ?? `{${k}}`));
            }
            return text;
        }
        function setLocale(locale) {
            const normalized = (locale === 'en-US' || locale === 'zh-CN') ? locale : (locale && String(locale).toLowerCase().startsWith('en') ? 'en-US' : 'zh-CN');
            currentLocale = normalized;
            try { localStorage.setItem('locale', normalized); } catch(_) {}
            document.documentElement.lang = normalized;
            applyTranslations();
        }
        function setNavLinkText(link, text) {
            if (!link) return;
            const icon = link.querySelector('.nav-icon');
            const arrow = link.querySelector('.nav-arrow');
            if (icon || arrow) {
                const iconHTML = icon ? icon.outerHTML + ' ' : '';
                const arrowHTML = arrow ? ' ' + arrow.outerHTML : '';
                link.innerHTML = iconHTML + (text || '') + arrowHTML;
            } else {
                link.textContent = text || '';
            }
        }
        function applyTranslations() {
            // Â∑¶ÂÅ¥Â∞éËà™
            setNavLinkText(document.querySelector('[data-page="config"]'), t('nav.config'));
            const basicLink = document.querySelector('[data-page="basic-config"]');
            if (basicLink) basicLink.innerHTML = '<span class="submenu-icon">üîß</span>' + t('nav.basic');
            const modelLink = document.querySelector('[data-page="model-management"]');
            if (modelLink) modelLink.innerHTML = '<span class="submenu-icon">ü§ñ</span>' + t('nav.model');
            const knowledgeLink = document.querySelector('[data-page="knowledge-config"]');
            if (knowledgeLink) knowledgeLink.innerHTML = '<span class="submenu-icon">üìö</span>' + t('nav.knowledge');

            // È†ÇÈÉ®Ê®ôÈ°åÔºàÊ†πÊìöÁï∂Ââç hashÔºâ
            const hash = window.location.hash.substring(1) || 'basic-config';
            const map = {
                'basic-config': { title: t('page.basic.title'), desc: t('page.basic.desc') },
                'model-management': { title: t('page.model.title'), desc: t('page.model.desc') },
                'knowledge-config': { title: t('page.knowledge.title'), desc: t('page.knowledge.desc') },
            };
            const meta = map[hash] || { title: t('page.default.title'), desc: t('page.default.desc') };
            const pt = document.getElementById('pageTitle');
            const pd = document.getElementById('pageDescription');
            if (pt) pt.textContent = meta.title;
            if (pd) pd.textContent = meta.desc;

            // ÂÅ¥ÈÇäÊ¨ÑÂú®Á∑öÁãÄÊÖã
            const us = document.getElementById('userStatus');
            if (us) us.textContent = t('status.online');

            // ÂàùÂßã loading ÊñáÊ°à
            const loadingSpan = document.querySelector('#pageContent .loading span');
            if (loadingSpan) loadingSpan.textContent = t('loading');
        }

        // È†ÅÈù¢Â∞éËà™ÂäüËÉΩ
        const navLinks = document.querySelectorAll('.nav-link');
        const submenuLinks = document.querySelectorAll('.submenu-link');
        const pageTitle = document.getElementById('pageTitle');
        const pageDescription = document.getElementById('pageDescription');
        const pageContent = document.getElementById('pageContent');

        function handleApiCode(data) {
            const code = Number(data?.code);
            if (code === 700012006) {
                window.location.href = '/sign?redirect=%2Fadmin';
                return true;
            }
            if (code === 401) {
                const msg = data?.msg || data?.message || t('error.generic');
                alert(msg);
                window.location.href = '/';
                return true;
            }
            return false;
        }

        // È†ÅÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñË™ûË®ÄÔºàÂÑ™ÂÖà‰ΩøÁî®Êú¨Âú∞Â≠òÂÑ≤ÔºåÂê¶Ââá‰ΩøÁî®ÁÄèË¶ΩÂô®Ë™ûË®ÄÔºâ
            const storedLocale = (() => { try { return localStorage.getItem('locale'); } catch(_) { return null; } })();
            setLocale(storedLocale || (navigator.language && navigator.language.toLowerCase().startsWith('en') ? 'en-US' : 'zh-CN'));
            // Âä†ËºâÁî®Êà∂‰ø°ÊÅØ
            loadUserInfo();
            
            // ÂàùÂßãÂåñÂ≠êËèúÂñÆÂäüËÉΩ
            initSubmenuToggle();
            
            // ÈªòË™çÂ±ïÈñãÈÖçÁΩÆÁÆ°ÁêÜÂ≠êËèúÂñÆ
            const configMenu = document.querySelector('[data-page="config"]');
            if (configMenu) {
                const navItem = configMenu.closest('.nav-item');
                if (navItem) {
                    navItem.classList.add('expanded');
                }
            }
            
            // ÂæûURL hashÁç≤ÂèñÁï∂ÂâçÈ†ÅÈù¢ÔºåÂ¶ÇÊûúÊ≤íÊúâÂâáÈ°ØÁ§∫ÈªòË™çÈ†ÅÈù¢
            initPageFromURL();
        });

        // ÂæûURLÂàùÂßãÂåñÈ†ÅÈù¢
        function initPageFromURL() {
            const hash = window.location.hash.substring(1); // ÂéªÊéâ#Ëôü
            if (hash) {
                // Â¶ÇÊûúURL‰∏≠ÊúâhashÔºåÂä†ËºâÂ∞çÊáâÈ†ÅÈù¢
                loadPageFromHash(hash);
            } else {
                // Â¶ÇÊûúÊ≤íÊúâhashÔºåÈ°ØÁ§∫ÈªòË™çÈ†ÅÈù¢
                showDefaultPage();
            }
        }

        // ÂæûhashÂä†ËºâÈ†ÅÈù¢
        function loadPageFromHash(hash) {
            const pageConfig = {
                'basic-config': { title: t('page.basic.title'), description: t('page.basic.desc') },
                'model-management': { title: t('page.model.title'), description: t('page.model.desc') },
                'knowledge-config': { title: t('page.knowledge.title'), description: t('page.knowledge.desc') }
            };

            if (pageConfig[hash]) {
                // Ë®≠ÁΩÆÂ∞çÊáâÁöÑÂ∞éËà™È†ÖÁà≤Ê¥ªÂãïÁãÄÊÖã
                const targetLink = document.querySelector(`[data-page="${hash}"]`);
                if (targetLink) {
                    // ÁßªÈô§ÊâÄÊúâÊ¥ªÂãïÁãÄÊÖã
                    navLinks.forEach(l => l.classList.remove('active'));
                    submenuLinks.forEach(l => l.classList.remove('active'));
                    
                    // Ê∑ªÂä†Áï∂ÂâçÊ¥ªÂãïÁãÄÊÖã
                    targetLink.classList.add('active');
                    
                    // Â¶ÇÊûúÊòØÂ≠êËèúÂñÆÈ†ÖÔºåÁ¢∫‰øùÁà∂ËèúÂñÆÂ±ïÈñã
                    if (targetLink.classList.contains('submenu-link')) {
                        const parentNavItem = targetLink.closest('.nav-item');
                        if (parentNavItem) {
                            parentNavItem.classList.add('expanded');
                        }
                    }
                }
                
                // Âä†ËºâÈ†ÅÈù¢ÂÖßÂÆπ
                loadPageContent(hash);
            } else {
                // Â¶ÇÊûúhash‰∏çÂ≠òÂú®ÔºåÈ°ØÁ§∫ÈªòË™çÈ†ÅÈù¢
                showDefaultPage();
            }
        }

        // Âä†ËºâÁî®Êà∂‰ø°ÊÅØ
        async function loadUserInfo() {
            try {
                // ÂæûÁï∂ÂâçÈ†ÅÈù¢URLÁç≤Âèñhost
                const currentHost = window.location.origin;
                const apiUrl = `${currentHost}/api/passport/account/info/v2/`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                const result = await response.json();
                
                if (handleApiCode(result)) {
                    return;
                }
                
                if (result.code === 0 && result.data) {
                    // ÊáâÁî®Ë™ûË®Ä
                    const apiLocale = result.data.locale;
                    const storedLocale = (() => { try { return localStorage.getItem('locale'); } catch(_) { return null; } })();
                    setLocale(apiLocale || storedLocale || (navigator.language && navigator.language.toLowerCase().startsWith('en') ? 'en-US' : 'zh-CN'));

                    // Êõ¥Êñ∞Áî®Êà∂Âêç
                    const userNameElement = document.getElementById('userName');
                    if (userNameElement && result.data.name) {
                        userNameElement.textContent = result.data.name;
                    }
                    
                    // Êõ¥Êñ∞Áî®Êà∂È†≠ÂÉè
                    const userAvatarElement = document.getElementById('userAvatar');
                    if (userAvatarElement && result.data.avatar_url) {
                        // ÂâµÂª∫imgÂÖÉÁ¥†ÊõøÊèõÂéüÊúâÁöÑemoji
                        const img = document.createElement('img');
                        img.src = result.data.avatar_url;
                        img.alt = result.data.name || 'Áî®Êà∂È†≠ÂÉè';
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.borderRadius = '50%';
                        img.style.objectFit = 'cover';
                        
                        // Ê∑ªÂä†ÈåØË™§ËôïÁêÜÔºåÂ¶ÇÊûúÂúñÁâáÂä†ËºâÂ§±ÊïóÂâáÈ°ØÁ§∫ÈªòË™çÂúñÊ®ô
                        img.onerror = function() {
                            userAvatarElement.innerHTML = 'üë§';
                        };
                        
                        userAvatarElement.innerHTML = '';
                        userAvatarElement.appendChild(img);
                    }
                } else {
                    console.warn('Áî®Êà∂‰ø°ÊÅØÊé•Âè£ËøîÂõûÁï∞Â∏∏:', result);
                    // Êé•Âè£Áï∞Â∏∏ÊôÇ‰πüË®≠ÁΩÆ‰∏ÄÊ¨°Ë™ûË®ÄÔºàÂÖúÂ∫ïÔºâ
                    const storedLocale = (() => { try { return localStorage.getItem('locale'); } catch(_) { return null; } })();
                    setLocale(storedLocale || (navigator.language && navigator.language.toLowerCase().startsWith('en') ? 'en-US' : 'zh-CN'));
                }
            } catch (error) {
                console.error('Âä†ËºâÁî®Êà∂‰ø°ÊÅØÂ§±Êïó:', error);
                // ‰øùÊåÅÈªòË™çÈ°ØÁ§∫
            }
        }

        // ÂàùÂßãÂåñÂ≠êËèúÂñÆÂàáÊèõÂäüËÉΩ
        function initSubmenuToggle() {
            const hasSubmenuItems = document.querySelectorAll('.has-submenu');
            
            hasSubmenuItems.forEach(item => {
                const navLink = item.querySelector('.nav-link');
                navLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // ÂàáÊèõÂ±ïÈñãÁãÄÊÖã
                    item.classList.toggle('expanded');
                });
            });
        }

        // Â∞éËà™ÈªûÊìä‰∫ã‰ª∂
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const parentItem = link.closest('.nav-item');
                
                // Â¶ÇÊûú‰∏çÊòØÂ≠êËèúÂñÆÈ†ÖÔºåËôïÁêÜÈ†ÅÈù¢Ë∑≥ËΩâ
                if (!parentItem.classList.contains('has-submenu')) {
                    e.preventDefault();
                    
                    // ÁßªÈô§ÊâÄÊúâÊ¥ªÂãïÁãÄÊÖã
                    navLinks.forEach(l => l.classList.remove('active'));
                    submenuLinks.forEach(l => l.classList.remove('active'));
                    
                    // Ê∑ªÂä†Áï∂ÂâçÊ¥ªÂãïÁãÄÊÖã
                    link.classList.add('active');
                    
                    const pageName = link.getAttribute('data-page');
                    // Êõ¥Êñ∞URL hash
                    window.location.hash = pageName;
                    loadPageContent(pageName);
                }
            });
        });

        // Â≠êËèúÂñÆÈªûÊìä‰∫ã‰ª∂
        submenuLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // ÁßªÈô§ÊâÄÊúâÊ¥ªÂãïÁãÄÊÖã
                navLinks.forEach(l => l.classList.remove('active'));
                submenuLinks.forEach(l => l.classList.remove('active'));
                
                // Ê∑ªÂä†Áï∂ÂâçÊ¥ªÂãïÁãÄÊÖã
                link.classList.add('active');
                
                const pageName = link.getAttribute('data-page');
                // Êõ¥Êñ∞URL hash
                window.location.hash = pageName;
                loadPageContent(pageName);
            });
        });

        // Âä†ËºâÈ†ÅÈù¢ÂÖßÂÆπ
        function loadPageContent(pageName) {
            const pageConfig = {
                'basic-config': { title: t('page.basic.title'), description: t('page.basic.desc') },
                'model-management': { title: t('page.model.title'), description: t('page.model.desc') },
                'knowledge-config': { title: t('page.knowledge.title'), description: t('page.knowledge.desc') }
            };
            
            const config = pageConfig[pageName] || { title: t('page.default.title'), description: t('page.default.desc') };
            
            pageTitle.textContent = config.title;
            pageDescription.textContent = config.description;
            
            // È°ØÁ§∫È†ÅÈù¢ÂÖßÂÆπ
            showPageContent(pageName, config.title);
        }

        // È°ØÁ§∫ÈªòË™çÈ†ÅÈù¢
        function showDefaultPage() {
            // Ë®≠ÁΩÆÂü∫Á§éÈÖçÁΩÆÁà≤ÈÅ∏‰∏≠ÁãÄÊÖã
            const basicConfigLink = document.querySelector('[data-page="basic-config"]');
            if (basicConfigLink) {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªÂãïÁãÄÊÖã
                navLinks.forEach(l => l.classList.remove('active'));
                submenuLinks.forEach(l => l.classList.remove('active'));
                
                // Ê∑ªÂä†Âü∫Á§éÈÖçÁΩÆÁöÑÊ¥ªÂãïÁãÄÊÖã
                basicConfigLink.classList.add('active');
            }
            
            // Ë®≠ÁΩÆÈªòË™çÈ†ÅÈù¢ÁöÑURL hash
            window.location.hash = 'basic-config';
            loadPageContent('basic-config');
        }

        // È°ØÁ§∫È†ÅÈù¢ÂÖßÂÆπ
        function showPageContent(pageName, title) {
            // Â¶ÇÊûúÊòØÂü∫Á§éÈÖçÁΩÆÈ†ÅÈù¢ÔºåÂä†Ëºâconfig.htmlÁöÑÂÖßÂÆπ
            if (pageName === 'basic-config') {
                loadBasicConfigPage();
                return;
            }

            // Â¶ÇÊûúÊòØÊ®°ÂûãÁÆ°ÁêÜÈ†ÅÈù¢ÔºåÂä†ËºâÊ®°ÂûãÂàóË°®
            if (pageName === 'model-management') {
                loadModelManagementPage();
                return;
            }

            // Â¶ÇÊûúÊòØÁü•Ë≠òÂ∫´ÈÖçÁΩÆÈ†ÅÈù¢ÔºåÂä†ËºâÁü•Ë≠òÂ∫´ÈÖçÁΩÆ
            if (pageName === 'knowledge-config') {
                loadKnowledgeConfigPage();
                return;
            }
            
            pageContent.innerHTML = `
                <div style="padding: 30px;">
                    <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h2 style="color: #2c3e50; margin-bottom: 20px;">${title}</h2>
                        <p style="color: #7f8c8d; margin-bottom: 30px;">${t('page.contentArea', { title })}</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db;">
                                <h4 style="color: #2c3e50; margin: 0 0 10px;">${t('feature.module1')}</h4>
                                <p style="color: #7f8c8d; margin: 0; font-size: 14px;">${t('feature.desc')}</p>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #e74c3c;">
                                <h4 style="color: #2c3e50; margin: 0 0 10px;">${t('feature.module2')}</h4>
                                <p style="color: #7f8c8d; margin: 0; font-size: 14px;">${t('feature.desc')}</p>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #f39c12;">
                                <h4 style="color: #2c3e50; margin: 0 0 10px;">${t('feature.module3')}</h4>
                                <p style="color: #7f8c8d; margin: 0; font-size: 14px;">${t('feature.desc')}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 20px; background: #ecf0f1; border-radius: 6px;">
                            <h4 style="color: #2c3e50; margin: 0 0 15px;">${t('quick.title')}</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button style="background: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">${t('quick.new')}</button>
                                <button style="background: #2ecc71; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">${t('quick.import')}</button>
                                <button style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">${t('quick.export')}</button>
                                <button style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">${t('quick.settings')}</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Âä†ËºâÂü∫Á§éÈÖçÁΩÆÈ†ÅÈù¢ÔºàÂ∑≤ÂÖßËÅØÂà∞ index.htmlÔºâ
        function loadBasicConfigPage() {
            ensureConfigStylesInjected();
            pageContent.innerHTML = getBasicConfigMarkup();
            // Á∂ÅÂÆöÂΩàÁ™óÂáΩÊï∏Âà∞ÂÖ®Â±ÄÊµÆÂ±§
            overrideConfigOverlay();
            // ÂàùÂßãÂåñ‰∫§‰∫íËàáÊï∏Êìö
            setupConfigEventListeners();
            initConfigEmailTags();
            setTimeout(() => {
                if (typeof window.loadConfig === 'function') {
                    window.loadConfig();
                }
            }, 0);
        }

        // Â∞áÈÖçÁΩÆÈ†ÅÁöÑÂΩàÁ™óÁ∂ÅÂÆöÂà∞ index.html ÁöÑÂÖ®Â±ÄÊµÆÂ±§ÔºàÂÜ™Á≠â‰∏îÁÑ°ÈÅûÊ≠∏Ôºâ
        function overrideConfigOverlay() {
            if (window.__overlayBound) return;
            const baseShow = (typeof window.showOverlay === 'function') ? window.showOverlay.bind(window) : function(message, type){
                // ÂÖúÂ∫ïÔºöÂ¶ÇÊûúÂéüÂáΩÊï∏‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•Ë™øÁî®Êú¨Âú∞ÂØ¶Áèæ
                const overlay = document.getElementById('overlay');
                const overlayContent = document.getElementById('overlayContent');
                const overlayMessage = document.getElementById('overlayMessage');
                if (!overlay || !overlayContent || !overlayMessage) { alert(String(message || 'Êú™Áü•ÈåØË™§')); return; }
                overlayMessage.textContent = String(message || '');
                overlayContent.className = `overlay-content ${type === 'success' ? 'success' : 'error'}`;
                overlay.classList.add('show');
                overlay.onclick = function(e){ if (e.target === overlay) hideOverlay(); };
                setTimeout(() => hideOverlay(), 3000);
            };
            const baseHide = (typeof window.hideOverlay === 'function') ? window.hideOverlay.bind(window) : function(){
                const overlay = document.getElementById('overlay');
                if (overlay) overlay.classList.remove('show');
            };
            window.showOverlay = function(message, type) { baseShow(message, type); };
            window.hideOverlay = function() { baseHide(); };
            window.showError = function(message) { baseShow(message || t('error.generic'), 'error'); };
            window.showSuccess = function(message) { baseShow(message || t('success.generic'), 'success'); };
            window.__overlayBound = true;
        }

        // Ê≥®ÂÖ•Âü∫Á§éÈÖçÁΩÆÈ†Å CSSÔºàÁßªÈô§ overlay Áõ∏ÈóúÊ®£ÂºèÔºâ
        const CONFIG_PAGE_CSS = `
.page-content { max-width: 1000px; margin: 0 auto; padding: 30px; }
.page-header { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border-left: 4px solid #3498db; }
.page-title { font-size: 28px; font-weight: 600; color: #2c3e50; margin-bottom: 8px; }
.page-subtitle { font-size: 16px; color: #6c757d; font-weight: 400; }
.config-section { background: white; border-radius: 12px; padding: 30px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border: 1px solid #e1e8ed; transition: all 0.3s ease; }
.config-section:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.12); }
.section-title { font-size: 20px; font-weight: 600; color: #2c3e50; margin-bottom: 24px; display: flex; align-items: center; padding-bottom: 12px; border-bottom: 2px solid #f1f3f4; }
.section-icon { margin-right: 12px; font-size: 20px; color: #3498db; }
.form-group { margin-bottom: 24px; position: relative; }
.form-label { display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px; }
.form-input { width: 100%; padding: 12px 16px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; transition: all 0.3s ease; background: white; box-sizing: border-box; font-family: inherit; }
.form-input:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
.form-input:hover:not(:focus) { border-color: #bdc3c7; }
.form-textarea { min-height: 100px; resize: vertical; font-family: inherit; }
.form-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m6 8 4 4 4-4'/%3e%3c/svg%3e"); background-position: right 12px center; background-repeat: no-repeat; background-size: 16px; padding-right: 40px; cursor: pointer; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.checkbox-group { display: flex; align-items: center; margin-bottom: 16px; padding: 12px 16px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e1e8ed; transition: all 0.3s ease; }
.checkbox-group:hover { background: #f1f3f4; border-color: #bdc3c7; }
.checkbox-input { margin-right: 12px; width: 18px; height: 18px; accent-color: #3498db; cursor: pointer; }
.checkbox-group label { font-weight: 500; color: #374151; cursor: pointer; font-size: 14px; }
.radio-group { display: flex; gap: 16px; margin-top: 8px; }
.radio-item { display: flex; align-items: center; padding: 10px 16px; background: white; border-radius: 8px; border: 2px solid #e1e8ed; transition: all 0.3s ease; cursor: pointer; }
.radio-item:hover { background: #f8f9fa; border-color: #3498db; }
.radio-item:has(input:checked) { background: #e8f4fd; border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
.radio-input { margin-right: 8px; width: 18px; height: 18px; accent-color: #3498db; cursor: pointer; }
.radio-item label { font-weight: 500; color: #374151; cursor: pointer; font-size: 14px; }
.btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; margin-right: 12px; display: inline-flex; align-items: center; gap: 6px; text-decoration: none; font-family: inherit; }
.btn-primary { background: #3498db; color: white; box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3); }
.btn-primary:hover { background: #2980b9; box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4); }
.btn-primary:active { transform: translateY(1px); box-shadow: 0 1px 4px rgba(52, 152, 219, 0.3); }
.btn-secondary { background: #f8f9fa; color: #6c757d; border: 2px solid #e1e8ed; }
.btn-secondary:hover { background: #e9ecef; border-color: #bdc3c7; color: #495057; }
.registration-config-group { background: #f8f9fa; border-radius: 12px; padding: 20px; border: 2px solid #e1e8ed; margin-bottom: 20px; position: relative; }
.registration-config-group::before { content: 'üë•'; position: absolute; top: -12px; left: 20px; background: white; padding: 0 8px; font-size: 16px; color: #3498db; }
.registration-config-group .checkbox-group { margin-bottom: 16px; background: white; border: 2px solid #3498db; box-shadow: 0 2px 8px rgba(52, 152, 219, 0.1); }
.plugin-config-group::before { content: 'üß©'; position: absolute; top: -12px; left: 20px; background: white; padding: 0 8px; font-size: 16px; color: #3498db; }
.whitelist-email-config { margin-left: 30px; padding-left: 20px; border-left: 3px solid #3498db; background: white; border-radius: 8px; padding: 16px 20px; margin-bottom: 0; transition: all 0.3s ease; }
.whitelist-email-config.show { animation: slideDown 0.3s ease-out; }
.email-tags-container { border: 2px solid #e1e8ed; border-radius: 8px; padding: 8px; background: white; min-height: 48px; display: flex; flex-wrap: wrap; align-items: flex-start; gap: 6px; cursor: text; transition: border-color 0.3s ease; }
.email-tags-container:focus-within { border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
.email-tags { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
.email-tag { background: #3498db; color: white; padding: 4px 8px; border-radius: 16px; font-size: 12px; display: inline-flex; align-items: center; gap: 4px; max-width: 200px; overflow: hidden; }
.email-tag-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.email-tag-remove { background: none; border: none; color: white; cursor: pointer; padding: 0; width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; line-height: 1; transition: background-color 0.2s ease; }
.email-tag-remove:hover { background: rgba(255, 255, 255, 0.2); }
.email-input { border: none !important; box-shadow: none !important; padding: 4px 0 !important; margin: 0 !important; flex: 1; min-width: 200px; background: transparent !important; }
.email-input:focus { outline: none !important; border: none !important; box-shadow: none !important; }
.help-text { font-size: 12px; color: #9ca3af; margin-top: 6px; font-style: italic; }
.sandbox-config { display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e1e8ed; position: relative; }
.sandbox-config::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: #3498db; border-radius: 8px 8px 0 0; }
.sandbox-config.show { display: block; animation: slideDown 0.3s ease-out; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.sandbox-config h4 { margin-bottom: 16px; color: #2c3e50; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
.sandbox-config h4::before { content: 'üîß'; font-size: 16px; }
.loading { text-align: center; padding: 40px; color: #6c757d; background: white; border-radius: 12px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
.loading::before { content: '‚öôÔ∏è'; font-size: 32px; display: block; margin-bottom: 12px; animation: spin 2s linear infinite; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.error { background: #fee2e2; color: #dc2626; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #dc2626; font-weight: 500; }
.success { background: #dcfce7; color: #16a34a; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #16a34a; font-weight: 500; }
.action-buttons { margin-top: 30px; padding-top: 24px; border-top: 2px solid #f1f3f4; text-align: center; }
`;

        function ensureConfigStylesInjected() {
            const existingStyle = document.querySelector('style[data-config-page="true"]');
            if (existingStyle) return;
            const style = document.createElement('style');
            style.setAttribute('data-config-page', 'true');
            style.textContent = CONFIG_PAGE_CSS;
            document.head.appendChild(style);
        }

        // Âü∫Á§éÈÖçÁΩÆÈ†ÅÈùúÊÖã DOM
        function getBasicConfigMarkup() {
            return `
<div class="page-content">

  <div id="loadingMessage" class="loading" style="display:none;">${t('basic.loading')}</div>
  <div id="errorMessage" class="error" style="display:none;"></div>
  <div id="successMessage" class="success" style="display:none;"></div>

  <form id="configForm" style="display:none;">
    <div class="config-section">
      <div class="form-group">
        <label class="form-label">${t('basic.label.admin_emails')}</label>
        <div class="email-tags-container" id="emailTagsContainer">
          <div class="email-tags" id="emailTags"></div>
          <input type="text" id="adminEmails" class="form-input email-input" placeholder="${t('basic.placeholder.email_input')}" />
        </div>
      </div>

      <div class="registration-config-group plugin-config-group">
        <div class="form-group">
          <label class="form-label">Coze API Token</label>
          <input type="password" id="cozeApiToken" class="form-input" placeholder="${t('basic.placeholder.coze_api_token')}">
          <div style="margin-top:8px;font-size:12px;">
            <a href="https://www.coze.cn/open/oauth/pats" target="_blank" rel="noopener noreferrer" style="color:#2980b9;text-decoration:none;">${t('basic.help.coze_api_token_apply')}</a>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="cozeSaasPluginEnabled" class="checkbox-input" />
            <label for="cozeSaasPluginEnabled">${t('basic.label.enable_coze_saas')}</label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Coze SaaS API Base URL</label>
          <input type="text" id="cozeSaasApiBaseUrl" class="form-input" placeholder="https://api.coze.cn" />
        </div>
      </div>

      <div class="registration-config-group">
        <div class="checkbox-group">
          <input type="checkbox" id="disableUserRegistration" class="checkbox-input" />
          <label for="disableUserRegistration">${t('basic.label.disable_user_registration')}</label>
        </div>

        <div id="whitelistEmailGroup" class="form-group whitelist-email-config" style="display:none;">
          <label class="form-label">${t('basic.label.whitelist_emails')}</label>
          <div class="email-tags-container" id="whitelistEmailTagsContainer">
            <div class="email-tags" id="whitelistEmailTags"></div>
            <input type="text" id="allowRegistrationEmail" class="form-input email-input" placeholder="${t('basic.placeholder.email_input')}" />
          </div>
          <div class="help-text">${t('basic.help.whitelist')}</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">${t('basic.label.python_env')}</label>
        <div class="radio-group">
          <div class="radio-item"><input type="radio" id="codeRunnerLocal" name="codeRunnerType" value="0" class="radio-input" /><label for="codeRunnerLocal">Local</label></div>
          <div class="radio-item"><input type="radio" id="codeRunnerSandbox" name="codeRunnerType" value="1" class="radio-input" /><label for="codeRunnerSandbox">Sandbox</label></div>
        </div>
        <div class="help-text">${t('basic.help.local_risk')}</div>
      </div>

      <div id="sandboxConfig" class="sandbox-config">
        <h4 style="margin-bottom: 15px; color: #2c3e50;">${t('basic.sandbox.title')}</h4>
        <div class="form-group">
          <label class="form-label">${t('basic.label.allow_env')}</label>
          <input type="text" id="allowEnv" class="form-input" placeholder="PATH,USERNAME">
        </div>
        <div class="form-group">
          <label class="form-label">${t('basic.label.allow_read')}</label>
          <input type="text" id="allowRead" class="form-input" placeholder="/tmp,./data">
        </div>
        <div class="form-group">
          <label class="form-label">${t('basic.label.allow_write')}</label>
          <input type="text" id="allowWrite" class="form-input" placeholder="/tmp,./data">
        </div>
        <div class="form-group">
          <label class="form-label">${t('basic.label.allow_run')}</label>
          <input type="text" id="allowRun" class="form-input" placeholder="python,git">
        </div>
        <div class="form-group">
          <label class="form-label">${t('basic.label.allow_net')}</label>
          <input type="text" id="allowNet" class="form-input" placeholder="cdn.jsdelivr.net">
        </div>
        <div class="form-group">
          <label class="form-label">${t('basic.label.allow_ffi')}</label>
          <input type="text" id="allowFfi" class="form-input" placeholder="/usr/lib/libm.so">
        </div>
        <div class="form-group">
          <label class="form-label">${t('basic.label.node_modules_dir')}</label>
          <input type="text" id="nodeModulesDir" class="form-input" placeholder="/tmp/path/node_modules">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">${t('basic.label.timeout_seconds')}</label>
            <input type="number" id="timeoutSeconds" class="form-input" placeholder="60" min="1" max="3600">
          </div>
          <div class="form-group">
            <label class="form-label">${t('basic.label.memory_limit_mb')}</label>
            <input type="number" id="memoryLimitMb" class="form-input" placeholder="100" min="1" max="10240">
          </div>
        </div>
      </div>
    </div>

    <div class="config-section">
      <h3 class="section-title"><span class="section-icon">üåê</span>${t('server.title')}</h3>
      <div class="form-group">
        <label class="form-label">${t('server.host.label')}</label>
        <input type="text" id="serverHost" class="form-input" placeholder="localhost:8888" />
        <div class="help-text">${t('server.host.help')}</div>
      </div>
    </div>

    <div class="action-buttons">
      <button type="button" class="btn btn-primary" onclick="saveConfig()">üíæ ${t('btn.save')}</button>
      <button type="button" class="btn btn-secondary" onclick="loadConfig()">üîÑ ${t('btn.reload')}</button>
    </div>
  </form>
</div>`;
        }

        // -------------------- Âü∫Á§éÈÖçÁΩÆÈ†ÅËÖ≥Êú¨ÔºàÈÅøÂÖçËàáÂÖ®Â±ÄÂëΩÂêçË°ùÁ™ÅÔºâ --------------------
        let currentConfig = {};
        let emailTags = [];
        let whitelistEmailTags = [];

        function getConfigTagsArray(containerId) {
            if (containerId === 'emailTags') return emailTags;
            if (containerId === 'whitelistEmailTags') return whitelistEmailTags;
            return [];
        }

        function initConfigEmailTags() {
            initConfigEmailTagsForInput('adminEmails', 'emailTags', 'emailTags');
            initConfigEmailTagsForInput('allowRegistrationEmail', 'whitelistEmailTags', 'whitelistEmailTags');
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function initConfigEmailTagsForInput(inputId, containerId, type) {
            const inputEl = document.getElementById(inputId);
            const container = document.getElementById(containerId);
            if (!inputEl || !container) return;

            const handleAdd = () => {
                const value = inputEl.value.trim();
                if (value) {
                    addConfigEmailTagForInput(type, value);
                    inputEl.value = '';
                }
            };

            inputEl.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    handleAdd();
                } else if (e.key === 'Backspace' && !inputEl.value) {
                    const tags = getConfigTagsArray(containerId);
                    tags.pop();
                    renderConfigEmailTagsForInput(containerId, tags);
                }
            });

            inputEl.addEventListener('blur', handleAdd);
        }

        function addConfigEmailTagForInput(type, value) {
            const containerId = type === 'emailTags' ? 'emailTags' : 'whitelistEmailTags';
            const tags = getConfigTagsArray(containerId);

            if (!isValidEmail(value)) {
                showError('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈÉµÁÆ±Âú∞ÂùÄ');
                return;
            }

            if (tags.includes(value)) {
                showError('Ë©≤ÈÉµÁÆ±Â∑≤Â≠òÂú®');
                return;
            }

            tags.push(value);
            renderConfigEmailTagsForInput(containerId, tags);
        }

        function removeConfigEmailTagForInput(type, index) {
            const containerId = type === 'emailTags' ? 'emailTags' : 'whitelistEmailTags';
            const tags = getConfigTagsArray(containerId);
            tags.splice(index, 1);
            renderConfigEmailTagsForInput(containerId, tags);
        }

        function renderConfigEmailTagsForInput(containerId, tags) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            tags.forEach((tag, index) => {
                const tagElement = document.createElement('span');
                tagElement.className = 'email-tag';
                tagElement.innerHTML = `
                    <span class="email-tag-text" title="${tag}">${tag}</span>
                    <button class="email-tag-remove" onclick="removeConfigEmailTagForInput('${containerId === 'emailTags' ? 'emailTags' : 'whitelistEmailTags'}', ${index})">√ó</button>
                `;
                container.appendChild(tagElement);
            });
        }

        function setEmailTags(emails) {
            const inputEmails = Array.isArray(emails) ? emails : (emails || '').split(/[,\s]+/).filter(Boolean);
            const nowEmails = emailTags || [];
            const allEmails = Array.from(new Set([...(nowEmails || []), ...(inputEmails || [])]));
            emailTags = allEmails;
            renderConfigEmailTagsForInput('emailTags', emailTags);
        }

        function getEmailTags() {
            return (emailTags || []).join(',');
        }

        function setWhitelistEmailTags(emails) {
            const inputEmails = Array.isArray(emails) ? emails : (emails || '').split(/[,\s]+/).filter(Boolean);
            const nowEmails = whitelistEmailTags || [];
            const allEmails = Array.from(new Set([...(nowEmails || []), ...(inputEmails || [])]));
            whitelistEmailTags = allEmails;
            renderConfigEmailTagsForInput('whitelistEmailTags', whitelistEmailTags);
        }

        function getWhitelistEmailTags() {
            return (whitelistEmailTags || []).join(',');
        }

        function setupConfigEventListeners() {
            const disableEl = document.getElementById('disableUserRegistration');
            const whitelistGroup = document.getElementById('whitelistEmailGroup');
            if (disableEl && whitelistGroup) {
                disableEl.addEventListener('change', function () {
                    toggleConfigWhitelistEmailConfig(disableEl.checked);
                });
            }

            const localEl = document.getElementById('codeRunnerLocal');
            const sandboxEl = document.getElementById('codeRunnerSandbox');
            if (localEl && sandboxEl) {
                const updateSandbox = () => toggleConfigSandboxConfig(sandboxEl.checked);
                localEl.addEventListener('change', updateSandbox);
                sandboxEl.addEventListener('change', updateSandbox);
            }
        }

        function toggleConfigWhitelistEmailConfig(show) {
            const el = document.getElementById('whitelistEmailGroup');
            if (!el) return;
            el.style.display = show ? 'block' : 'none';
            if (show) el.classList.add('show'); else el.classList.remove('show');
        }

        function toggleConfigSandboxConfig(show) {
            const el = document.getElementById('sandboxConfig');
            if (!el) return;
            el.style.display = show ? 'block' : 'none';
            if (show) el.classList.add('show'); else el.classList.remove('show');
        }

        function loadConfig() {
            showConfigLoading(true);
            hideMessages();
            fetch('/api/admin/config/basic/get')
                .then(response => response.json())
                .then(data => {
                    if (handleApiCode(data)) {
                        showConfigLoading(false);
                        return;
                    }
                    if (!data || !data.configuration) {
                        showError(t('error.load_failed_empty'));
                        // Âú®ÁÑ°ÂæåÁ´ØÊàñÊé•Âè£Áï∞Â∏∏ÊôÇ‰πüÂ±ïÁ§∫Ë°®ÂñÆÔºå‰æøÊñºÊâãÂãïÈÖçÁΩÆ
                        populateForm({});
                        showConfigForm(true);
                        showConfigLoading(false);
                        return;
                    }
                    currentConfig = data.configuration || {};
                    populateForm(currentConfig);
                    showConfigForm(true);
                    showConfigLoading(false);
                })
                .catch(err => {
                    console.error('Failed to load configuration:', err);
                    showError(t('error.load_failed_json'));
                    // ÁÑ°ÂæåÁ´ØÊôÇÂ±ïÁ§∫Á©∫Ë°®ÂñÆ‰ª•‰æøÁπºÁ∫åÊìç‰Ωú
                    populateForm({});
                    showConfigForm(true);
                    showConfigLoading(false);
                });
        }

        function populateForm(cfg) {
            document.getElementById('serverHost').value = cfg.server_host || '';

            // ÁÆ°ÁêÜÂì°ÈÉµÁÆ±
            setEmailTags(cfg.admin_emails || '');

            // Êèí‰ª∂ÈÖçÁΩÆÔºöCoze API Token + SaaS Áõ∏Èóú
            const pluginCfg = cfg.plugin_configuration || {};
            const cozeEl = document.getElementById('cozeApiToken');
            if (cozeEl) cozeEl.value = pluginCfg.coze_api_token || cfg.coze_api_token || '';
            const saasEnabledEl = document.getElementById('cozeSaasPluginEnabled');
            if (saasEnabledEl) saasEnabledEl.checked = (pluginCfg.coze_saas_plugin_enabled === true || pluginCfg.coze_saas_plugin_enabled === 'true');
            const saasBaseUrlEl = document.getElementById('cozeSaasApiBaseUrl');
            if (saasBaseUrlEl) saasBaseUrlEl.value = pluginCfg.coze_saas_api_base_url || 'https://api.coze.cn';

            // Á¶ÅÊ≠¢Áî®Êà∂Ë®ªÂÜäËàáÁôΩÂêçÂñÆ
            const disableReg = cfg.disable_user_registration === true || cfg.disable_user_registration === 'true';
            const disableEl = document.getElementById('disableUserRegistration');
            if (disableEl) disableEl.checked = disableReg;
            toggleConfigWhitelistEmailConfig(disableReg);
            setWhitelistEmailTags(cfg.allow_registration_email || '');

            // ‰ª£Á¢ºÈÅãË°åÁí∞Â¢É
            const crt = Number(cfg.code_runner_type || 0);
            const localEl = document.getElementById('codeRunnerLocal');
            const sandboxEl = document.getElementById('codeRunnerSandbox');
            if (localEl && sandboxEl) {
                localEl.checked = crt !== 1;
                sandboxEl.checked = crt === 1;
            }
            toggleConfigSandboxConfig(crt === 1);

            // Sandbox ÈÖçÁΩÆ
            const s = cfg.sandbox_config || {};
            if (document.getElementById('allowEnv')) document.getElementById('allowEnv').value = s.allow_env || '';
            if (document.getElementById('allowRead')) document.getElementById('allowRead').value = s.allow_read || '';
            if (document.getElementById('allowWrite')) document.getElementById('allowWrite').value = s.allow_write || '';
            if (document.getElementById('allowRun')) document.getElementById('allowRun').value = s.allow_run || '';
            if (document.getElementById('allowNet')) document.getElementById('allowNet').value = s.allow_net || 'cdn.jsdelivr.net';
            if (document.getElementById('allowFfi')) document.getElementById('allowFfi').value = s.allow_ffi || '';
            if (document.getElementById('nodeModulesDir')) document.getElementById('nodeModulesDir').value = s.node_modules_dir || '';
            if (document.getElementById('timeoutSeconds')) document.getElementById('timeoutSeconds').value = s.timeout_seconds || '';
            if (document.getElementById('memoryLimitMb')) document.getElementById('memoryLimitMb').value = s.memory_limit_mb || '';
        }

        function collectFormData() {
            const serverHost = document.getElementById('serverHost').value.trim();
            const adminEmails = getEmailTags();
            const allowedEmails = getWhitelistEmailTags();
            const disableReg = document.getElementById('disableUserRegistration').checked;
            const codeRunnerType = document.getElementById('codeRunnerSandbox').checked ? 1 : 0;
            const cozeApiToken = (document.getElementById('cozeApiToken')?.value || '').trim();
            const cozeSaasPluginEnabled = !!(document.getElementById('cozeSaasPluginEnabled')?.checked);
            const cozeSaasApiBaseUrlRaw = (document.getElementById('cozeSaasApiBaseUrl')?.value || '');
            const cozeSaasApiBaseUrl = (cozeSaasApiBaseUrlRaw ? cozeSaasApiBaseUrlRaw : 'https://api.coze.cn').replace(/`/g, '').trim();

            const sAllowEnv = (document.getElementById('allowEnv')?.value || '').trim();
            const sAllowRead = (document.getElementById('allowRead')?.value || '').trim();
            const sAllowWrite = (document.getElementById('allowWrite')?.value || '').trim();
            const sAllowRun = (document.getElementById('allowRun')?.value || '').trim();
            const sAllowNet = (document.getElementById('allowNet')?.value || '').trim();
            const sAllowFfi = (document.getElementById('allowFfi')?.value || '').trim();
            const sNodeModulesDir = (document.getElementById('nodeModulesDir')?.value || '').trim();
            const sTimeoutSeconds = document.getElementById('timeoutSeconds')?.value;
            const sMemoryLimitMb = document.getElementById('memoryLimitMb')?.value;

            const configuration = {
                admin_emails: adminEmails,
                disable_user_registration: disableReg,
                allow_registration_email: allowedEmails,
                code_runner_type: codeRunnerType,
                server_host: serverHost,
                plugin_configuration: {
                    coze_saas_plugin_enabled: cozeSaasPluginEnabled,
                    coze_api_token: cozeApiToken,
                    coze_saas_api_base_url: cozeSaasApiBaseUrl
                }
            };

            if (codeRunnerType === 1) {
                configuration.sandbox_config = {
                    allow_env: sAllowEnv,
                    allow_read: sAllowRead,
                    allow_write: sAllowWrite,
                    allow_run: sAllowRun,
                    allow_net: sAllowNet || 'cdn.jsdelivr.net',
                    allow_ffi: sAllowFfi,
                    node_modules_dir: sNodeModulesDir,
                    timeout_seconds: sTimeoutSeconds ? parseFloat(sTimeoutSeconds) : undefined,
                    memory_limit_mb: sMemoryLimitMb ? parseInt(sMemoryLimitMb, 10) : undefined
                };
            }

            return { configuration };
        }

        function saveConfig() {
            const payload = collectFormData();
            if (!payload.configuration.admin_emails) {
                showError(t('error.admin_email_required'));
                return;
            }
            if (!payload.configuration.server_host) {
                showError(t('error.server_host_required'));
                return;
            }

            // È©óË≠âÁï∂ÂâçÊ®ôÁ±§‰∏≠ÁöÑÈÉµÁÆ±Ê†ºÂºèÔºàÊúÄÁµÇÂÖúÂ∫ïÊ™¢Êü•Ôºâ
            const invalidAdmin = (emailTags || []).filter(e => e && !isValidEmail(e));
            const invalidWhitelist = (whitelistEmailTags || []).filter(e => e && !isValidEmail(e));
            if (invalidAdmin.length > 0) {
                showError(t('error.invalid_admin_emails', { list: invalidAdmin.join(', ') }));
                return;
            }
            if (invalidWhitelist.length > 0) {
                showError(t('error.invalid_whitelist_emails', { list: invalidWhitelist.join(', ') }));
                return;
            }

            showConfigLoading(true);
            hideMessages();
            fetch('/api/admin/config/basic/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                if (handleApiCode(data)) {
                    showConfigLoading(false);
                    return;
                }
                if (data && Number(data.code) === 0) {
                    showSuccess(t('success.saved'));
                } else {
                    const msg = (data && (data.msg || data.message)) ? (data.msg || data.message) : t('error.save_failed');
                    showError(msg);
                }
                showConfigLoading(false);
            })
            .catch(err => {
                console.error(t('knowledge.error.save_failed') + ':', err);
                showError(t('error.save_failed_json'));
                showConfigLoading(false);
            });
        }

        function showConfigLoading(show) {
            const el = document.getElementById('loadingMessage');
            if (el) el.style.display = show ? 'block' : 'none';
        }

        function showConfigForm(show) {
            const el = document.getElementById('configForm');
            if (el) el.style.display = show ? 'block' : 'none';
        }

        function hideMessages() {
            const errEl = document.getElementById('errorMessage');
            const sucEl = document.getElementById('successMessage');
            if (errEl) errEl.style.display = 'none';
            if (sucEl) sucEl.style.display = 'none';
        }

        // È°ØÁ§∫Â∑•‰ΩúËá∫ÂÖßÂÆπ
        function showWorkspaceContent() {
            const now = new Date();
            const localeFmt = (currentLocale === 'en-US') ? 'en-US' : 'zh-CN';
            const today = now.toLocaleDateString(localeFmt, {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const hour = now.getHours();
            let greetingKey = 'workspace.greeting.evening';
            if (hour < 6) {
                greetingKey = 'workspace.greeting.late';
            } else if (hour < 12) {
                greetingKey = 'workspace.greeting.morning';
            } else if (hour < 14) {
                greetingKey = 'workspace.greeting.noon';
            } else if (hour < 18) {
                greetingKey = 'workspace.greeting.afternoon';
            } else {
                greetingKey = 'workspace.greeting.evening';
            }
            const greeting = t(greetingKey);
            
            pageContent.innerHTML = `
                <div style="padding: 30px;">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 15px; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);">
                            <h1 style="margin: 0 0 15px; font-size: 2.5em; font-weight: 300;">${t('workspace.hero.title')}</h1>
                            <p style="margin: 0 0 20px; font-size: 1.2em; opacity: 0.9;">${greeting}</p>
                            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; display: inline-block;">
                                <p style="margin: 0; font-size: 1.1em; font-weight: 500;">üìÖ ${today}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #3498db;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="background: #3498db; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 18px;">üîß</div>
                                <h3 style="margin: 0; color: #2c3e50;">${t('workspace.card.basic.title')}</h3>
                            </div>
                            <p style="color: #7f8c8d; margin-bottom: 15px; line-height: 1.6;">${t('workspace.card.basic.desc')}</p>
                            <button onclick="loadPageContent('basic-config')" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s;">${t('workspace.card.basic.cta')}</button>
                        </div>
                        
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #2ecc71;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="background: #2ecc71; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 18px;">ü§ñ</div>
                                <h3 style="margin: 0; color: #2c3e50;">${t('workspace.card.model.title')}</h3>
                            </div>
                            <p style="color: #7f8c8d; margin-bottom: 15px; line-height: 1.6;">${t('workspace.card.model.desc')}</p>
                            <button onclick="loadPageContent('model-management')" style="background: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s;">${t('workspace.card.model.cta')}</button>
                        </div>
                        
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #f39c12;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="background: #f39c12; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 18px;">üìö</div>
                                <h3 style="margin: 0; color: #2c3e50;">${t('workspace.card.knowledge.title')}</h3>
                            </div>
                            <p style="color: #7f8c8d; margin-bottom: 15px; line-height: 1.6;">${t('workspace.card.knowledge.desc')}</p>
                            <button onclick="loadPageContent('knowledge-config')" style="background: #f39c12; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s;">${t('workspace.card.knowledge.cta')}</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center; color: #95a5a6; font-size: 14px;">
                        <p>üöÄ ${t('workspace.footer.cta')}</p>
                    </div>
                </div>
            `;
        }

        // Ê®°ÂûãÁÆ°ÁêÜÈ†ÅÈù¢ÔºöÂä†ËºâËàáÊ∏≤Êüì
        async function loadModelManagementPage() {
            try {
                showLoading();
                const currentHost = window.location.origin;
                const apiUrl = `${currentHost}/api/admin/config/model/list`;
                const response = await fetch(apiUrl, { method: 'GET', headers: { 'Accept': 'application/json' } });
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                if (handleApiCode(data)) {
                    return;
                }
                renderModelManagement(data);
            } catch (error) {
                console.error(t('model.error.load_list_failed'), error);
                showError(t('model.error.load_list_failed') + ': ' + error.message);
            }
        }

        function sanitizeUrl(url) {
            if (!url) return '';
            return String(url).replace(/`/g, '').trim();
        }

        function maskApiKey(key) {
            if (!key) return t('common.not_configured');
            const s = String(key);
            if (s.length <= 10) return '***';
            return s.slice(0, 6) + '***' + s.slice(-4);
        }

        function getThinkingTypeText(thinkingTypeValue) {
            const thinkingType = Number(thinkingTypeValue);
            switch (thinkingType) {
                case 0: return t('model.thinking_type.default');
                case 1: return t('model.thinking_type.enable');
                case 2: return t('model.thinking_type.disable');
                case 3: return t('model.thinking_type.auto');
                default: return '-';
            }
        }

        function renderModelManagement(payload) {
            try {
                const providers = Array.isArray(payload?.provider_model_list) ? payload.provider_model_list : [];
                const html = `
                    <div style="padding: 30px;">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
                            <div>
                                <h2 style="color:#2c3e50;margin:0 0 8px;">${t('model.list.title')}</h2>
                            </div>
                            <div style="font-size:12px;color:#95a5a6;">${t('model.provider.count', { count: providers.length })}</div>
                        </div>

                        <!-- Ê∑ªÂä†Ê®°ÂûãÂΩàÁ™ó -->
                        <div id="addModelModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:9999;">
                            <div style="background:#fff;width:480px;max-width:90vw;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);overflow:hidden;">
                                <div style="padding:16px 20px;border-bottom:1px solid #f1f3f4;display:flex;justify-content:space-between;align-items:center;">
                                    <div style="font-weight:600;color:#2c3e50;">${t('model.modal.add.title')}</div>
                                    <button onclick="closeAddModelModal()" style="background:transparent;border:none;font-size:20px;color:#6c757d;cursor:pointer;">√ó</button>
                                </div>
                                <div style="padding:20px;display:flex;flex-direction:column;gap:12px;">
                                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                                        <img id="modalProviderIcon" src="" alt="" style="width:24px;height:24px;border-radius:6px;object-fit:cover;display:none;">
                                        <div id="modalProviderName" style="font-size:12px;color:#6c757d;"></div>
                                    </div>
                                    <label style="font-size:12px;color:#374151;">${t('model.modal.display_name.label')}<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></label>
                                    <input id="newModelDisplayName" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;" placeholder="${t('model.modal.display_name.placeholder')}">
                                    <label style="font-size:12px;color:#374151;">${t('model.modal.model.label')}<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></label>
                                    <input id="newModelModel" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;" placeholder="${t('model.modal.model.placeholder')}">
                                    <label id="newModelApiKeyLabel" style="font-size:12px;color:#374151;">${t('model.modal.api_key.label')}<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></label>
                                    <input id="newModelApiKey" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;" placeholder="${t('model.modal.api_key.placeholder')}">
                                    <label style="font-size:12px;color:#374151;">${t('model.modal.base_url.label')}</label>
                                    <input id="newModelBaseUrl" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;" placeholder="${t('model.modal.base_url.placeholder')}">
                                    <label style="font-size:12px;color:#374151;">${t('model.modal.enable_base64_url.label')}</label>
                                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                                        <input id="newModelEnableBase64Url" type="checkbox">
                                        <span style="font-size:12px;color:#6c757d;">${t('model.modal.enable_base64_url.help')}</span>
                                    </div>
                                    <label id="newModelArkRegionLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.ark_region.label')}</label>
                                    <input id="newModelArkRegion" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;display:none;" placeholder="${t('model.modal.ark_region.placeholder')}">
                                    <label id="newModelOpenAIByAzureLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.azure.label')}</label>
                                    <div id="newModelOpenAIByAzureWrapper" style="display:none;align-items:center;gap:8px;margin-bottom:4px;">
                                        <input id="newModelOpenAIByAzure" type="checkbox">
                                        <span style="font-size:12px;color:#6c757d;">${t('model.modal.azure.help')}</span>
                                    </div>
                                    <label id="newModelOpenAIApiVersionLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.openai_api_version.label')}</label>
                                     <input id="newModelOpenAIApiVersion" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;display:none;" placeholder="${t('model.modal.openai_api_version.placeholder')}">
                                     <label id="newModelGeminiBackendLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.gemini_backend.label')}</label>
                                       <select id="newModelGeminiBackend" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;display:none;">
                                           <option value="0" selected>${t('model.modal.gemini_backend.unspecified')}</option>
                    <option value="1">${t('model.modal.gemini_backend.gemini_api')}</option>
                    <option value="2">${t('model.modal.gemini_backend.vertex_ai')}</option>
                                       </select>
                                     <label id="newModelGeminiProjectLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.gemini_project.label')}</label>
                                     <input id="newModelGeminiProject" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;display:none;" placeholder="${t('model.modal.gemini_project.placeholder')}">
                                     <label id="newModelGeminiLocationLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.gemini_location.label')}</label>
                                     <input id="newModelGeminiLocation" type="text" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;display:none;" placeholder="${t('model.modal.gemini_location.placeholder')}">
                                     <label id="newModelThinkingTypeLabel" style="font-size:12px;color:#374151;display:none;">${t('model.modal.thinking_type.label')}</label>
                                     <select id="newModelThinkingType" style="padding:8px;border:1px solid #e1e8ed;border-radius:8px;width:100%;display:none;">
                                       <option value="2" selected>${t('model.modal.thinking_type.disable')}</option>
                                       <option value="1">${t('model.modal.thinking_type.enable')}</option>
                                       <option id="thinkingTypeAutoOption" value="3" style="display:none;">${t('model.modal.thinking_type.auto')}</option>
                                     </select>
                                </div>
                                <div style="padding:12px 20px;display:flex;justify-content:flex-end;gap:8px;border-top:1px solid #f1f3f4;">
                                    <button onclick="closeAddModelModal()" style="background:#ecf0f1;color:#2c3e50;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;">${t('common.cancel')}</button>
                                    <button id="addModelSubmitBtn" onclick="saveNewModel()" style="background:#667eea;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;">${t('common.save')}</button>
                                </div>
                            </div>
                        </div>

                        <div style="display:grid;grid-template-columns:1fr;gap:20px;">
                            ${providers.map(pm => {
                                const p = pm.provider || {};
                                const name = p.name?.zh_cn || p.name?.en_us || t('model.provider.unnamed');
                                const desc = p.description?.zh_cn || p.description?.en_us || '';
                                const icon = p.icon_url || p.icon_uri || '';
                                const models = Array.isArray(pm.model_list) ? pm.model_list : [];
                                return `
                                    <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:1px solid #e1e8ed;overflow:hidden;">
                                        <div style="display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid #f1f3f4;background:#f8f9fa;">
                                            <div style="display:flex;align-items:center;gap:12px;">
                                                <img src="${icon}" alt="${name}" onerror="this.style.display='none'" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">
                                                <div>
                                                    <div style="font-weight:600;color:#2c3e50;">${name}</div>
                                                    <div style="color:#6c757d;font-size:12px;">${desc}</div>
                                                </div>
                                            </div>
                                            <button onclick="openAddModelModalWithProvider(this)" data-provider-name="${name}" data-provider-icon="${icon}" data-provider-class="${p.model_class}" style="background:#3498db;color:#fff;border:none;padding:8px 12px;border-radius:6px;font-size:12px;cursor:pointer;">${t('model.actions.add')}</button>
                                        </div>
                                        <div style="padding:16px;">
                                            <div style="color:#7f8c8d;font-size:12px;margin-bottom:12px;">${t('model.provider.model_count', { count: models.length })}</div>
                                            ${models.map(m => {
                                                const di = m.display_info || {};
                                                const conn = m.connection?.base_conn_info || {};
                                                const modelName = di.name || conn.model || t('model.unnamed');
                                                const baseUrl = sanitizeUrl(conn.base_url || '');
                                                const apiKeyMasked = maskApiKey(conn.api_key || '');
                                                const outputTokens = di.output_tokens ?? '-';
                                                const maxTokens = di.max_tokens ?? '-';
                                                const statusText = m.status === 1 ? t('common.enabled') : t('common.disabled');
                                                const statusColor = m.status === 1 ? '#2ecc71' : '#e74c3c';
                                                const modelId = m.id ?? m.model_id ?? '';
                                                return `
                                                    <div style="border:1px solid #e1e8ed;border-radius:10px;padding:12px;margin-bottom:12px;background:#ffffff;">
                                                        <div style="display:flex;justify-content:space-between;align-items:center;">
                                                            <div style="font-weight:500;color:#2c3e50;">${modelName}</div>
                                                            <div style="display:flex;align-items:center;gap:8px;">
                                                                <span style="font-size:12px;color:${statusColor};">${statusText}</span>
                                                                <button onclick="deleteModel('${modelId}')" style="background:#e74c3c;color:#fff;border:none;padding:4px 8px;border-radius:6px;font-size:12px;cursor:pointer;">${t('common.delete')}</button>
                                                            </div>
                                                        </div>
                                                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;margin-top:10px;font-size:12px;color:#374151;">
                                                            <div>${t('model.field.id')}Ôºö${m.id ?? m.model_id ?? '-'}</div>
                                                            <div>${t('model.field.model')}Ôºö${conn.model || '-'}</div>
                                                            ${p?.model_class === 20 ? '' : `<div>${t('model.field.api_key')}Ôºö${apiKeyMasked}</div>`}
                                                            <div>${t('model.field.base64_url')}Ôºö${m.enable_base64_url ? t('common.on') : t('common.off')}</div>
                                                            ${[2, 3, 11, 15, 20].includes(p?.model_class) ? `<div>${t('model.field.thinking_type')}Ôºö${getThinkingTypeText(conn.thinking_type ?? 0)}</div>` : ''}
                                                            ${p?.model_class === 2 ? `<div>${t('model.field.region')}Ôºö${m?.connection?.ark?.region || ''}</div>` : ''}
                                                            ${p?.model_class === 11 ? `<div>${t('model.field.backend')}Ôºö${m?.connection?.gemini?.backend ?? ''}</div><div>${t('model.field.project')}Ôºö${m?.connection?.gemini?.project || ''}</div><div>${t('model.field.location')}Ôºö${m?.connection?.gemini?.location || ''}</div>` : ''}
                                                            ${p?.model_class === 1 ? `<div>${t('model.field.azure')}Ôºö${(m?.connection?.openai?.by_azure === undefined) ? '' : (m?.connection?.openai?.by_azure ? 'true' : 'false')}</div><div>${t('model.field.api_version')}Ôºö${m?.connection?.openai?.api_version || ''}</div>` : ''}
                                                        </div>
                                                        <div style="margin-top:8px;font-size:12px;color:#374151;word-break:break-all;">
                                                            ${t('model.field.endpoint')}Ôºö<span style="color:#3498db;">${baseUrl || '-'}</span>
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                pageContent.innerHTML = html;
            } catch (e) {
                console.error(t('model.error.render_page_failed'), e);
                showError(t('model.error.render_page_failed') + ': ' + e.message);
            }
        }

        async function deleteModel(id) {
             try {
                 if (!id) {
                     showError(t('model.error.delete_missing_id'));
                     return;
                 }
                 const confirmed = window.confirm(t('model.confirm.delete'));
                 if (!confirmed) {
                     return; // Áî®Êà∂ÂèñÊ∂à
                 }
                 const resp = await fetch('/api/admin/config/model/delete', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify({ id: String(id) })
                 });
                 if (!resp.ok) {
                     throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
                 }
                 let data;
                 try {
                    data = await resp.json();
                } catch (err) {
                    showError(t('model.error.delete_invalid_json'));
                    return;
                }
                if (handleApiCode(data)) {
                    return;
                }
                if (data?.code !== 0) {
                     showError(t('model.error.delete_failed') + ': ' + (data?.msg || t('common.unknown_error')));
                     return;
                 }
                 // Âà∑Êñ∞Ê®°ÂûãÂàóË°®
                 await loadModelManagementPage();
             } catch (error) {
                 showError(t('model.error.delete_failed') + ': ' + error.message);
             }
         }
 
         function openAddModelModalWithProvider(btn) {
              const modal = document.getElementById('addModelModal');
              if (!modal) { showError(t('model.error.open_modal_failed')); return; }
              const nameEl = document.getElementById('modalProviderName');
              const iconEl = document.getElementById('modalProviderIcon');
              const providerName = btn?.dataset?.providerName || t('model.provider.unknown');
              const providerIcon = btn?.dataset?.providerIcon || '';
              const providerClassStr = btn?.dataset?.providerClass;
              const providerClass = providerClassStr ? Number(providerClassStr) : undefined;
              window.__selectedProvider = { name: providerName, icon: providerIcon, model_class: providerClass };
              if (nameEl) nameEl.textContent = providerName;
              if (iconEl) {
                  if (providerIcon) {
                      iconEl.src = providerIcon; iconEl.alt = providerName; iconEl.style.display = 'block';
                  } else {
                      iconEl.src = ''; iconEl.style.display = 'none';
                  }
              }
              // Ê†πÊìö provider Èö±ËóèÊàñÈ°ØÁ§∫ API Key Â≠óÊÆµÔºàOllama ‰∏çÈúÄË¶ÅÔºâ
              const apiLabel = document.getElementById('newModelApiKeyLabel');
              const apiInput = document.getElementById('newModelApiKey');
              const isOllama = providerClass === 20; // developer_api.ModelClass_Llama
              if (apiLabel) apiLabel.style.display = isOllama ? 'none' : '';
              if (apiInput) apiInput.style.display = isOllama ? 'none' : '';
              // Ê†πÊìö provider È°ØÁ§∫ Ark ÁöÑ Region Â≠óÊÆµÔºàÂÉÖ Doubao/ArkÔºåclass=2Ôºâ
              const arkLabel = document.getElementById('newModelArkRegionLabel');
              const arkInput = document.getElementById('newModelArkRegion');
              const isArk = providerClass === 2;
              if (arkLabel) arkLabel.style.display = isArk ? '' : 'none';
              if (arkInput) arkInput.style.display = isArk ? '' : 'none';
              // Ê†πÊìö provider È°ØÁ§∫ OpenAI ÁöÑ Azure Ëàá API Version Â≠óÊÆµÔºàÂÉÖ OpenAIÔºåclass=1Ôºâ
              const openaiByAzureLabel = document.getElementById('newModelOpenAIByAzureLabel');
              const openaiByAzureWrapper = document.getElementById('newModelOpenAIByAzureWrapper');
              const openaiApiVersionLabel = document.getElementById('newModelOpenAIApiVersionLabel');
              const openaiApiVersionInput = document.getElementById('newModelOpenAIApiVersion');
              const isOpenAI = providerClass === 1;
              if (openaiByAzureLabel) openaiByAzureLabel.style.display = isOpenAI ? '' : 'none';
              if (openaiByAzureWrapper) openaiByAzureWrapper.style.display = isOpenAI ? 'flex' : 'none';
              if (openaiApiVersionLabel) openaiApiVersionLabel.style.display = isOpenAI ? '' : 'none';
              if (openaiApiVersionInput) openaiApiVersionInput.style.display = isOpenAI ? '' : 'none';
              // Ê†πÊìö provider È°ØÁ§∫ Gemini ÁöÑÂæåÁ´Ø„ÄÅÈ†ÖÁõÆ„ÄÅ‰ΩçÁΩÆÔºàÂÉÖ GeminiÔºåclass=11Ôºâ
              const geminiBackendLabel = document.getElementById('newModelGeminiBackendLabel');
              const geminiBackendInput = document.getElementById('newModelGeminiBackend');
              const geminiProjectLabel = document.getElementById('newModelGeminiProjectLabel');
              const geminiProjectInput = document.getElementById('newModelGeminiProject');
              const geminiLocationLabel = document.getElementById('newModelGeminiLocationLabel');
              const geminiLocationInput = document.getElementById('newModelGeminiLocation');
              const isGemini = providerClass === 11;
              if (geminiBackendLabel) geminiBackendLabel.style.display = isGemini ? '' : 'none';
              if (geminiBackendInput) geminiBackendInput.style.display = isGemini ? '' : 'none';
              if (geminiProjectLabel) geminiProjectLabel.style.display = isGemini ? '' : 'none';
              if (geminiProjectInput) geminiProjectInput.style.display = isGemini ? '' : 'none';
              if (geminiLocationLabel) geminiLocationLabel.style.display = isGemini ? '' : 'none';
              if (geminiLocationInput) geminiLocationInput.style.display = isGemini ? '' : 'none';
              
              // Show/hide ThinkingType dropdown
              const thinkingTypeLabel = document.getElementById('newModelThinkingTypeLabel');
              const thinkingTypeSelect = document.getElementById('newModelThinkingType');
              const thinkingTypeAutoOption = document.getElementById('thinkingTypeAutoOption');
              const hasThinkingType = [2, 3, 11, 15, 20].includes(providerClass); // Ark, Claude, Gemini, Qwen, Ollama
              const isArkProvider = providerClass === 2;
              if (thinkingTypeLabel) thinkingTypeLabel.style.display = hasThinkingType ? '' : 'none';
              if (thinkingTypeSelect) {
                  thinkingTypeSelect.style.display = hasThinkingType ? '' : 'none';
                  thinkingTypeSelect.value = '2'; // Reset to Disable
              }
              if (thinkingTypeAutoOption) thinkingTypeAutoOption.style.display = isArkProvider ? '' : 'none';
              
              modal.style.display = 'flex';
          }
          function closeAddModelModal() {
              const modal = document.getElementById('addModelModal');
              if (modal) modal.style.display = 'none';
          }
          async function saveNewModel() {
              const name = document.getElementById('newModelDisplayName')?.value?.trim() || '';
              const model = document.getElementById('newModelModel')?.value?.trim() || '';
              const apiKey = document.getElementById('newModelApiKey')?.value?.trim() || '';
              const baseUrl = document.getElementById('newModelBaseUrl')?.value?.trim() || '';
              // ÂÖÅË®± Base URL Áà≤Á©∫ÔºõÂÉÖÂ∞çÂøÖÂ°´È†ÖÂÅöÊ†°È©óÔºå‰∏¶Âú®‰øùÂ≠òÊúüÈñìÁ¶ÅÁî®ÊåâÈàïËàáÈ°ØÁ§∫ÊèêÁ§∫
              const submitBtn = document.getElementById('addModelSubmitBtn');
              const restoreSavingState = () => {
                  if (submitBtn) {
                      submitBtn.disabled = false;
                      if (submitBtn.dataset.originalText) submitBtn.textContent = submitBtn.dataset.originalText;
                      submitBtn.style.opacity = '';
                      submitBtn.style.cursor = 'pointer';
                  }
              };
              if (submitBtn) {
                  submitBtn.disabled = true;
                  submitBtn.dataset.originalText = submitBtn.textContent;
                  submitBtn.textContent = t('common.saving');
                  submitBtn.style.opacity = '0.7';
                  submitBtn.style.cursor = 'not-allowed';
              }
              const providerClass = window.__selectedProvider?.model_class;
              if (typeof providerClass !== 'number') {
                  showError(t('model.error.provider_unrecognized'));
                  restoreSavingState();
                  return;
              }
              const requireApiKey = providerClass !== 20; // Ollama ‰∏çÈúÄË¶Å API Key
              if (!name || !model || (requireApiKey && !apiKey)) {
                  const missingMsg = requireApiKey ? t('model.error.missing_required_with_api') : t('model.error.missing_required');
                  showError(missingMsg);
                  restoreSavingState();
                  return;
              }
              // ÊßãÈÄ† payloadÔºåBase URL Áà≤Á©∫ÊôÇ‰∏çÂÇ≥Ë©≤Â≠óÊÆµÔºõOllama ‰∏çÂÇ≥ api_key
              const baseConn = { model: model };
              if (baseUrl) baseConn.base_url = baseUrl;
              if (requireApiKey && apiKey) baseConn.api_key = apiKey;
              
              // ËÆÄÂèñ ThinkingTypeÔºàÂÉÖ Ark, Claude, Gemini, Qwen, OllamaÔºâ
              const thinkingTypeSelect = document.getElementById('newModelThinkingType');
              const hasThinkingType = [2, 3, 11, 15, 20].includes(providerClass);
              if (hasThinkingType && thinkingTypeSelect) {
                  const thinkingTypeValue = parseInt(thinkingTypeSelect.value, 10);
                  if (!Number.isNaN(thinkingTypeValue)) {
                      baseConn.thinking_type = thinkingTypeValue;
                  }
              }
              // ËÆÄÂèñ‚ÄúÂïìÁî® Base64 URL‚ÄùË§áÈÅ∏Ê°ÜÔºåÈªòË™ç false
              const enableBase64UrlEl = document.getElementById('newModelEnableBase64Url');
              const enableBase64Url = !!(enableBase64UrlEl && enableBase64UrlEl.checked);
              const arkRegionInput = document.getElementById('newModelArkRegion');
              const arkRegion = arkRegionInput ? arkRegionInput.value.trim() : '';
              const connection = { base_conn_info: baseConn };
              if (providerClass === 2) {
                  connection.ark = { region: arkRegion };
              }
              // ËÆÄÂèñ OpenAI Êì¥Â±ïÂ≠óÊÆµÔºàÂÉÖ providerClass=1Ôºâ
              const openaiByAzureEl = document.getElementById('newModelOpenAIByAzure');
              const openaiByAzure = !!(openaiByAzureEl && openaiByAzureEl.checked);
              const openaiApiVersionEl = document.getElementById('newModelOpenAIApiVersion');
              const openaiApiVersion = openaiApiVersionEl ? openaiApiVersionEl.value.trim() : '';
              if (providerClass === 1 && (openaiByAzure || openaiApiVersion)) {
                  const openaiObj = {};
                  // Â¶ÇÊûú‰ªª‰∏ÄÂ≠óÊÆµÊúâÂÄºÔºåÂâáÁµÑË£ù openai Â∞çË±°Ôºõby_azure ÂßãÁµÇÊåâÁï∂ÂâçÈñãÈóúÁãÄÊÖãÂÇ≥ÈÅû
                  openaiObj.by_azure = openaiByAzure;
                  if (openaiApiVersion) openaiObj.api_version = openaiApiVersion;
                  connection.openai = openaiObj;
              }
              // ËÆÄÂèñ Gemini Êì¥Â±ïÂ≠óÊÆµÔºàÂÉÖ providerClass=11ÔºâÔºåÊåâÈúÄÂØ´ÂÖ•
              const geminiBackendEl = document.getElementById('newModelGeminiBackend');
              const geminiProjectEl = document.getElementById('newModelGeminiProject');
              const geminiLocationEl = document.getElementById('newModelGeminiLocation');
              const geminiBackendRaw = geminiBackendEl ? geminiBackendEl.value.trim() : '';
              const hasGeminiBackend = geminiBackendRaw !== '';
              const geminiBackend = hasGeminiBackend ? parseInt(geminiBackendRaw, 10) : NaN;
              const geminiProject = geminiProjectEl ? geminiProjectEl.value.trim() : '';
              const geminiLocation = geminiLocationEl ? geminiLocationEl.value.trim() : '';
              if (providerClass === 11 && (hasGeminiBackend || geminiProject || geminiLocation)) {
                  const geminiObj = {};
                  if (hasGeminiBackend && !Number.isNaN(geminiBackend)) geminiObj.backend = geminiBackend;
                  if (geminiProject) geminiObj.project = geminiProject;
                  if (geminiLocation) geminiObj.location = geminiLocation;
                  connection.gemini = geminiObj;
              }
              const payload = {
                  model_name: name,
                  model_class: providerClass,
                  enable_base64_url: enableBase64Url,
                  connection
              };
              try {
                  const resp = await fetch('/api/admin/config/model/create', {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(payload)
                  });
                  // ‰∏ç‰æùË≥¥ resp.okÔºåÁµ±‰∏ÄÊåâ‚ÄúJSON ÂÑ™ÂÖàÔºåÊñáÊú¨ÂÖúÂ∫ï‚ÄùËôïÁêÜ
                  let rawText = '';
                  try {
                      rawText = await resp.text();
                  } catch (e) {
                      showError(t('model.error.create_read_failed'));
                      return;
                  }
                  let data = null;
                  try {
                      data = JSON.parse(rawText);
                  } catch (e) {
                      data = null;
                  }
                  if (data && typeof data === 'object') {
                      if (handleApiCode(data)) {
                          return;
                      }
                      const code = Number(data.code);
                      if (code === 0) {
                          closeAddModelModal();
                          showSuccess(t('model.create.success'));
                          await loadModelManagementPage();
                          return;
                      }
                      showError(t('model.error.create_failed') + ': ' + (data?.msg || `HTTP ${resp.status}`));
                      return;
                  } else {
                      showError(`${t('model.error.create_failed')}: HTTP ${resp.status} ${rawText || ''}`);
                      return;
                  }
              } catch (error) {
                  showError(t('model.error.create_failed') + ': ' + error.message);
              } finally {
                  restoreSavingState();
              }
          }

          // Áü•Ë≠òÂ∫´ÈÖçÁΩÆÈ†ÅÈù¢ÔºöÂä†ËºâËàáÊ∏≤ÊüìÔºàÊîØÊåÅÊú¨Âú∞È†êË¶ΩÁ§∫‰æãÊï∏ÊìöÂÖúÂ∫ïÔºâ
          async function loadKnowledgeConfigPage() {
              ensureConfigStylesInjected();
              try {
                  showLoading();
                  const currentHost = window.location.origin;
                  const apiUrl = `${currentHost}/api/admin/config/knowledge/get`;
                  const resp = await fetch(apiUrl, { method: 'GET', headers: { 'Accept': 'application/json' } });
                  if (!resp.ok) {
                      throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
                  }
                  let data;
                  try {
                      data = await resp.json();
                  } catch (err) {
                      if (isLocalPreview()) {
                          renderDemo();
                          return;
                      }
                      showError(t('knowledge.error.load_failed_json'));
                      return;
                  }
                  if (handleApiCode(data)) {
                      return;
                  }
                  if (typeof data?.code === 'number' && data.code !== 0) {
                      if (isLocalPreview()) { renderDemo(); return; }
                      showError(t('knowledge.error.load_failed_msg', { msg: (data?.msg || t('error.api_error')) }));
                      return;
                  }
                  if (!data?.knowledge_config) {
                      if (isLocalPreview()) {
                          renderDemo();
                          return;
                      }
                      showError(t('knowledge.error.load_failed_empty'));
                      return;
                  }
                  renderKnowledgeConfig(data.knowledge_config);
              } catch (error) {
                  console.error(t('knowledge.error.load_failed') + ':', error);
                  if (isLocalPreview()) {
                      renderDemo();
                      return;
                  }
                  showError(t('knowledge.error.load_failed_reason', { reason: error.message }));
              }

              function isLocalPreview() {
                  const host = window.location.hostname;
                  return host === 'localhost' || host === '127.0.0.1';
              }

              function renderDemo() {
                  // ‰∏çÂÜçÊ≥®ÂÖ•Á§∫‰æãÊï∏ÊìöÔºå‰ΩøÁî®Á©∫ÈÖçÁΩÆÈÄ≤Ë°åÈ†ÅÈù¢Ê∏≤Êüì‰ª•‰æøÊú¨Âú∞È†êË¶Ω UI
                  renderKnowledgeConfig({});
                  console.info(t('knowledge.log.local_preview_no_demo'));
              }
          }

          function formatValue(val) {
              if (val === undefined || val === null) return '';
              return String(val);
          }

          function renderKnowledgeConfig(cfg) {
              try {
                  const embedding = cfg?.embedding_config || {};
                  const rerank = cfg?.rerank_config || {};
                  const ocr = cfg?.ocr_config || {};
                  const parser = cfg?.parser_config || {};
                  const builtinModelId = cfg?.builtin_model_id ?? '';

                  const conn = embedding?.connection || {};
                  const baseConn = conn?.base_conn_info || {};
                  const embeddingInfo = conn?.embedding_info || {};

                  const initial = {
                      embedding_type: embedding?.type ?? '',
                      embedding_max_batch_size: Number(embedding?.max_batch_size ?? 100),
                      ark_base_url:  baseConn?.base_url || '',
                      ark_api_key:  baseConn?.api_key || '',
                      ark_region: conn?.ark?.region || '',
                      ark_model: baseConn?.model || '',
                      ark_embedding_dims: embeddingInfo?.dims ?? '0',
                      ark_embedding_api_type: conn?.ark?.embedding_api_type || conn?.ark?.api_type || '',
                      openai_base_url: baseConn?.base_url || '',
                      openai_api_key:  baseConn?.api_key || '',
                      openai_model:  baseConn?.model || '',
                      openai_embedding_dims: embeddingInfo?.dims ?? '0',
                      openai_embedding_by_azure: Boolean(conn?.openai?.embedding_by_azure ?? conn?.openai?.by_azure),
                      openai_embedding_api_version: conn?.openai?.embedding_api_version ?? conn?.openai?.api_version ?? '',
                      ollama_base_url: baseConn?.base_url || '',
                      ollama_model: baseConn?.model || '',
                      ollama_embedding_dims: embeddingInfo?.dims ?? '0',
                      gemini_base_url:  baseConn?.base_url || '',
                      gemini_api_key:  baseConn?.api_key || '',
                      gemini_model:  baseConn?.model || '',
                      gemini_embedding_dims: embeddingInfo?.dims ?? '0',
                      gemini_embedding_backend: conn?.gemini?.embedding_backend ?? conn?.gemini?.backend ?? '',
                      gemini_embedding_project: conn?.gemini?.embedding_project ?? conn?.gemini?.project ?? '',
                      gemini_embedding_location: conn?.gemini?.embedding_location ?? conn?.gemini?.location ?? '',
                      http_address: conn?.http?.address || '',
                      http_dims: embeddingInfo?.dims ?? '0',
                      rerank_type: rerank?.type ?? '',
                      vik_ak: rerank?.vikingdb_config?.ak || '',
                      vik_sk: rerank?.vikingdb_config?.sk || '',
                      vik_host: rerank?.vikingdb_config?.host || '',
                      vik_region: rerank?.vikingdb_config?.region || '',
                      vik_model: rerank?.vikingdb_config?.model || '',
                      ocr_type: ocr?.type ?? '',
                      ocr_ark_ak: ocr?.ark_ak || ocr?.volcengine_ak || '',
                      ocr_ark_sk: ocr?.ark_sk || ocr?.volcengine_sk || '',
                      ocr_paddleocr_api_url: ocr?.paddleocr_api_url || '',
                      parser_type: parser?.type ?? '',
                      parser_paddleocr_structure_api_url: parser?.paddleocr_structure_api_url || '',
                      builtin_model_id: builtinModelId ?? ''
                  };

                  if (initial.embedding_type==0) {
                    initial.openai_api_key ='';
                    initial.openai_base_url ='';
                    initial.openai_model ='';
                    initial.openai_embedding_dims ='';
                    initial.ollama_base_url ='';
                    initial.ollama_model ='';
                    initial.ollama_embedding_dims ='';
                    initial.gemini_base_url ='';
                    initial.gemini_api_key ='';
                    initial.gemini_model ='';
                    initial.gemini_embedding_dims ='';
                    initial.http_address ='';
                    initial.http_dims ='';
                  }else if (initial.embedding_type==1) {
                    initial.ark_base_url ='';
                    initial.ark_api_key ='';
                    initial.ark_region ='';
                    initial.ark_model ='';
                    initial.ark_embedding_dims ='';
                    initial.ollama_base_url ='';
                    initial.ollama_model ='';
                    initial.ollama_embedding_dims ='';
                    initial.gemini_base_url ='';
                    initial.gemini_api_key ='';
                    initial.gemini_model ='';
                    initial.gemini_embedding_dims ='';
                    initial.http_address ='';
                    initial.http_dims ='';
                  } else if (initial.embedding_type==2) {
                    initial.openai_api_key ='';
                    initial.openai_base_url ='';
                    initial.openai_model ='';
                    initial.openai_embedding_dims ='';
                    initial.ark_base_url ='';
                    initial.ark_api_key ='';
                    initial.ark_region ='';
                    initial.ark_model ='';
                    initial.ark_embedding_dims ='';
                    initial.gemini_base_url ='';
                    initial.gemini_api_key ='';
                    initial.gemini_model ='';
                    initial.http_address ='';
                    initial.http_dims ='';
                  } else if (initial.embedding_type==3) {
                    initial.openai_api_key ='';
                    initial.openai_base_url ='';
                    initial.openai_model ='';
                    initial.openai_embedding_dims ='';
                    initial.ark_base_url ='';
                    initial.ark_api_key ='';
                    initial.ark_region ='';
                    initial.ark_model ='';
                    initial.ark_embedding_dims ='';
                    initial.ollama_base_url ='';
                    initial.ollama_model ='';
                    initial.ollama_embedding_dims ='';
                    initial.http_address ='';
                    initial.http_dims ='';
                  } else if (initial.embedding_type==4) {
                    initial.openai_api_key ='';
                    initial.openai_base_url ='';
                    initial.openai_model ='';
                    initial.openai_embedding_dims ='';
                    initial.ark_base_url ='';
                    initial.ark_api_key ='';
                    initial.ark_region ='';
                    initial.ark_model ='';
                    initial.ark_embedding_dims ='';
                    initial.ollama_base_url ='';
                    initial.ollama_model ='';
                    initial.ollama_embedding_dims ='';
                    initial.gemini_base_url ='';
                    initial.gemini_api_key ='';
                    initial.gemini_model ='';
                    initial.gemini_embedding_dims ='';
                  }

                  const inputStyle = "width:100%;padding:8px;border:1px solid #e1e8ed;border-radius:6px;font-size:12px;";
                  const labelStyle = "font-size:12px;color:#374151;margin-bottom:6px;";
                  const groupGrid = "display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;";

                  const html = `
                      <div style="padding: 30px;">
                        <div style="display:grid;grid-template-columns:1fr;gap:20px;">

                          <!-- Group 1: Embedding ÈÖçÁΩÆ -->
                          <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:1px solid #e1e8ed;overflow:hidden;">
                            <div style="padding:16px;border-bottom:1px solid #f1f3f4;background:#f8f9fa;">
                              <div style="font-weight:600;color:#2c3e50;">${t('knowledge.section.embedding')}</div>
                            </div>
                            <div style="padding:16px;">
                              <div style="${groupGrid}">
                                <div>
                                  <div style="${labelStyle}">Type</div>
                                  <select id="kb_embedding_type" style="${inputStyle}" onchange="onEmbeddingTypeChange()">
                                    <option value="0" ${Number(initial.embedding_type) === 0 ? 'selected' : ''}>Ark</option>
                                    <option value="1" ${Number(initial.embedding_type) === 1 ? 'selected' : ''}>OpenAI</option>
                                    <option value="2" ${Number(initial.embedding_type) === 2 ? 'selected' : ''}>Ollama</option>
                                    <option value="3" ${Number(initial.embedding_type) === 3 ? 'selected' : ''}>Gemini</option>
                                    <option value="4" ${Number(initial.embedding_type) === 4 ? 'selected' : ''}>HTTP</option>
                                  </select>
                                </div>
                                <div>
                                  <div style="${labelStyle}">Max Batch Size</div>
                                  <input id="kb_embedding_max_batch_size" type="number" style="${inputStyle}" value="${initial.embedding_max_batch_size}" />
                                </div>
                              </div>

                              <div id="kb_conn_ark" style="margin-top:12px;border:1px solid #f1f3f4;border-radius:8px;padding:12px;">
                                <div style="font-weight:600;color:#2c3e50;margin-bottom:8px;">${t('knowledge.connection', { name: 'Ark' })}</div>
                                <div style="${groupGrid}">
                                  <div>
                                    <div style="${labelStyle}">Base URL<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_ark_base_url" type="text" style="${inputStyle}" value="${initial.ark_base_url}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">API Key<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_ark_api_key" type="text" style="${inputStyle}" value="${initial.ark_api_key}" />
                                  </div>
                                  <div style="display:none;">
                                    <div style="${labelStyle}">Region</div>
                                    <input id="kb_ark_region" type="text" style="${inputStyle}" value="${initial.ark_region}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Model<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_ark_model" type="text" style="${inputStyle}" value="${initial.ark_model}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Dims</div>
                                    <input id="kb_ark_embedding_dims" type="number" min="0" style="${inputStyle}" value="${initial.ark_embedding_dims}" />
                                </div>
                                  <div>
                                    <div style="${labelStyle}">API Type</div>
                                    <select id="kb_ark_embedding_api_type" style="${inputStyle}">
                                      <option value="text_api" ${initial.ark_embedding_api_type === 'text_api' ? 'selected' : ''}>text_api</option>
                                      <option value="multi_modal_api" ${initial.ark_embedding_api_type === 'multi_modal_api' ? 'selected' : ''}>multi_modal_api</option>
                                    </select>
                                  </div>
                                </div>
                              </div>

                              <div id="kb_conn_openai" style="margin-top:12px;border:1px solid #f1f3f4;border-radius:8px;padding:12px;">
                                <div style="font-weight:600;color:#2c3e50;margin-bottom:8px;">${t('knowledge.connection', { name: 'OpenAI' })}</div>
                                <div style="${groupGrid}">
                                  <!-- ÂøÖÂ°´Â≠óÊÆµÂÑ™ÂÖàÈ°ØÁ§∫ÔºöBase URL„ÄÅModel„ÄÅAPI Key„ÄÅDimsÔºàÁ¥ÖÈªûÔºâ -->
                                  <div>
                                    <div style="${labelStyle}">Base URL<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_openai_base_url" type="text" style="${inputStyle}" value="${initial.openai_base_url}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Model<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_openai_model" type="text" style="${inputStyle}" value="${initial.openai_model}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">API Key<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_openai_api_key" type="text" style="${inputStyle}" value="${initial.openai_api_key}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Dims</div>
                                    <input id="kb_openai_embedding_dims" type="number" min="0" style="${inputStyle}" value="${initial.openai_embedding_dims}" />
                                </div>
                                  <!-- ÈÅ∏Â°´Â≠óÊÆµÈù†ÂæåÈ°ØÁ§∫ÔºöBy Azure„ÄÅAPI Version„ÄÅRequest Dims -->
                                  <div>
                                    <div style="${labelStyle}">By Azure</div>
                                    <input id="kb_openai_embedding_by_azure" type="checkbox" ${initial.openai_embedding_by_azure ? 'checked' : ''} />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Embedding API Version</div>
                                    <input id="kb_openai_embedding_api_version" type="text" style="${inputStyle}" value="${initial.openai_embedding_api_version}" />
                                  </div>
                                </div>
                              </div>

                              <div id="kb_conn_ollama" style="margin-top:12px;border:1px solid #f1f3f4;border-radius:8px;padding:12px;">
                                <div style="font-weight:600;color:#2c3e50;margin-bottom:8px;">${t('knowledge.connection', { name: 'Ollama' })}</div>
                                <div style="${groupGrid}">
                                  <div>
                                    <div style="${labelStyle}">Base URL<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_ollama_base_url" type="text" style="${inputStyle}" value="${initial.ollama_base_url}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Model<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_ollama_model" type="text" style="${inputStyle}" value="${initial.ollama_model}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Dims</div>
                                    <input id="kb_ollama_embedding_dims" type="number" min="0" style="${inputStyle}" value="${initial.ollama_embedding_dims}" />
                                </div>
                                </div>
                              </div>

                              <div id="kb_conn_gemini" style="margin-top:12px;border:1px solid #f1f3f4;border-radius:8px;padding:12px;">
                                <div style="font-weight:600;color:#2c3e50;margin-bottom:8px;">${t('knowledge.connection', { name: 'Gemini' })}</div>
                                <div style="${groupGrid}">
                                  <div>
                                    <div style="${labelStyle}">Base URL<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_gemini_base_url" type="text" style="${inputStyle}" value="${initial.gemini_base_url}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">API Key<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_gemini_api_key" type="text" style="${inputStyle}" value="${initial.gemini_api_key}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Model<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_gemini_model" type="text" style="${inputStyle}" value="${initial.gemini_model}" />
                                  </div>
                           
                                  <div>
                                    <div style="${labelStyle}">Backend<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_gemini_embedding_backend" type="number" style="${inputStyle}" value="${initial.gemini_embedding_backend}" />
                                  </div>
                                <div>
                                    <div style="${labelStyle}">Dims</div>
                                    <input id="kb_gemini_embedding_dims" type="number" min="0" style="${inputStyle}" value="${initial.gemini_embedding_dims}" />
                                </div>
                                  <div>
                                    <div style="${labelStyle}">Project</div>
                                    <input id="kb_gemini_embedding_project" type="text" style="${inputStyle}" value="${initial.gemini_embedding_project}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Location</div>
                                    <input id="kb_gemini_embedding_location" type="text" style="${inputStyle}" value="${initial.gemini_embedding_location}" />
                                  </div>
                                </div>
                              </div>

                              <div id="kb_conn_http" style="margin-top:12px;border:1px solid #f1f3f4;border-radius:8px;padding:12px;">
                                <div style="font-weight:600;color:#2c3e50;margin-bottom:8px;">${t('knowledge.connection', { name: 'HTTP' })}</div>
                                <div style="${groupGrid}">
                                  <div>
                                    <div style="${labelStyle}">Address<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_http_address" type="text" style="${inputStyle}" value="${initial.http_address}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Dims</div>
                                    <input id="kb_http_dims" type="number" min="0" style="${inputStyle}" value="${initial.http_dims}" />
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Group 2: Rerank ÈÖçÁΩÆ -->
                          <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:1px solid #e1e8ed;overflow:hidden;">
                            <div style="padding:16px;border-bottom:1px solid #f1f3f4;background:#f8f9fa;">
                              <div style="font-weight:600;color:#2c3e50;">${t('knowledge.section.rerank')}</div>
                            </div>
                            <div style="padding:16px;">
                              <div style="${groupGrid}">
                                <div>
                                  <div style="${labelStyle}">Type</div>
                                  <select id="kb_rerank_type" style="${inputStyle}" onchange="onRerankTypeChange()">
                                    <option value="0" ${Number(initial.rerank_type) === 0 ? 'selected' : ''}>VikingDB</option>
                                    <option value="1" ${Number(initial.rerank_type) === 1 ? 'selected' : ''}>RRF</option>
                                  </select>
                                </div>
                              </div>
                              <div id="kb_conn_vikingdb" style="margin-top:12px;border:1px solid #f1f3f4;border-radius:8px;padding:12px;">
                                <div style="font-weight:600;color:#2c3e50;margin-bottom:8px;">VikingDB</div>
                                <div style="${groupGrid}">
                                  <div>
                                    <div style="${labelStyle}">AK<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_vik_ak" type="text" style="${inputStyle}" value="${initial.vik_ak}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">SK<span style="display:inline-block;width:6px;height:6px;background:#e74c3c;border-radius:50%;margin-left:6px;"></span></div>
                                    <input id="kb_vik_sk" type="text" style="${inputStyle}" value="${initial.vik_sk}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Host</div>
                                    <input id="kb_vik_host" type="text" style="${inputStyle}" value="${initial.vik_host}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Region</div>
                                    <input id="kb_vik_region" type="text" style="${inputStyle}" value="${initial.vik_region}" />
                                  </div>
                                  <div>
                                    <div style="${labelStyle}">Model</div>
                                    <input id="kb_vik_model" type="text" style="${inputStyle}" value="${initial.vik_model}" />
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Group 3: OCR ÈÖçÁΩÆ -->
                          <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:1px solid #e1e8ed;overflow:hidden;">
                            <div style="padding:16px;border-bottom:1px solid #f1f3f4;background:#f8f9fa;">
                              <div style="font-weight:600;color:#2c3e50;">${t('knowledge.section.ocr')}</div>
                            </div>
                            <div style="padding:16px;">
                              <div style="${groupGrid}">
                                <div>
                                  <div style="${labelStyle}">Type</div>
                                  <select id="kb_ocr_type" style="${inputStyle}" onchange="onOcrTypeChange()">
                                    <option value="0" ${Number(initial.ocr_type) === 0 ? 'selected' : ''}>Volcengine</option>
                                    <option value="1" ${Number(initial.ocr_type) === 1 ? 'selected' : ''}>Paddleocr</option>
                                  </select>
                                </div>
                                <div id="kb_conn_ocr_volcengine">
                                  <div style="${labelStyle}">Volcengine AK</div>
                                  <input id="kb_ocr_ark_ak" type="text" style="${inputStyle}" value="${initial.ocr_ark_ak}" />
                                  <div style="${labelStyle};margin-top:12px;">Volcengine SK</div>
                                  <input id="kb_ocr_ark_sk" type="text" style="${inputStyle}" value="${initial.ocr_ark_sk}" />
                                </div>
                                <div id="kb_conn_ocr_paddleocr">
                                  <div style="${labelStyle}">PaddleOCR API URL</div>
                                  <input id="kb_ocr_paddleocr_api_url" type="text" style="${inputStyle}" value="${initial.ocr_paddleocr_api_url}" />
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Group 4: Parser ÈÖçÁΩÆ -->
                          <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:1px solid #e1e8ed;overflow:hidden;">
                            <div style="padding:16px;border-bottom:1px solid #f1f3f4;background:#f8f9fa;">
                              <div style="font-weight:600;color:#2c3e50;">${t('knowledge.section.parser')}</div>
                            </div>
                            <div style="padding:16px;">
                              <div style="${groupGrid}">
                                <div>
                                  <div style="${labelStyle}">Type</div>
                                  <select id="kb_parser_type" style="${inputStyle}" onchange="onParserTypeChange()">
                                    <option value="0" ${Number(initial.parser_type) === 0 ? 'selected' : ''}>Builtin</option>
                                    <option value="1" ${Number(initial.parser_type) === 1 ? 'selected' : ''}>Paddleocr</option>
                                  </select>
                                </div>
                                <div id="kb_conn_parser_paddleocr">
                                  <div style="${labelStyle}">PaddleOCR API URL</div>
                                  <input id="kb_parser_paddleocr_structure_api_url" type="text" style="${inputStyle}" value="${initial.parser_paddleocr_structure_api_url}" />
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Group 5: ÂÖßÁΩÆÊ®°ÂûãÈÖçÁΩÆ -->
                          <div id="kb_builtin_model_group" style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:1px solid #e1e8ed;overflow:hidden;">
                            <div style="padding:16px;border-bottom:1px solid #f1f3f4;background:#f8f9fa;">
                              <div style="font-weight:600;color:#2c3e50;">${t('knowledge.section.builtin_model')}</div>
                            </div>
                            <div style="padding:16px;">
                              <div style="${groupGrid}">
                                <div>
                                  <div style="${labelStyle}">${t('knowledge.label.choose_builtin_model')}</div>
                                  <div id="kb_builtin_model_select" style="position:relative;">
                                    <div id="kb_builtin_model_selected" style="display:flex;align-items:center;gap:8px;border:1px solid #e1e8ed;border-radius:8px;padding:8px;cursor:pointer;">
                                      <img id="kb_builtin_model_selected_icon" src="" alt="" style="width:20px;height:20px;border-radius:4px;object-fit:contain;display:none;">
                                      <span id="kb_builtin_model_selected_name" style="color:#2c3e50;">${t('knowledge.placeholder.select_model')}</span>
                                      <span style="margin-left:auto;color:#7b8a8b;">‚ñº</span>
                                    </div>
                                    <div id="kb_builtin_model_dropdown" style="margin-top:8px;background:#fff;border:1px solid #e1e8ed;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.08);max-height:240px;overflow:auto;display:none;z-index:10;">
                                      <div id="kb_builtin_model_loading" style="padding:8px;color:#7b8a8b;">${t('knowledge.loading.model_list')}</div>
                                    </div>
                                  </div>
                                  <input id="kb_builtin_model_id" type="hidden" value="${initial.builtin_model_id}" />
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>
                        <div class="action-buttons">
                          <button type="button" class="btn btn-primary" onclick="saveKnowledgeConfig()">üíæ ${t('btn.save')}</button>
                        </div>
                      </div>
                  `;
                  pageContent.innerHTML = html;
                  try {
                    const builtinGroup = document.getElementById('kb_builtin_model_group');
                    if (builtinGroup && builtinGroup.parentElement) {
                      builtinGroup.parentElement.insertBefore(builtinGroup, builtinGroup.parentElement.firstElementChild);
                    }
                  } catch (_) {}
                  try { setEmbeddingTypeUI(Number(initial.embedding_type ?? 0)); } catch (_) {}
                  try { setRerankTypeUI(Number(initial.rerank_type ?? 0)); } catch (_) {}
                  try { setOcrTypeUI(Number(initial.ocr_type ?? 0)); } catch (_) {}
                  try { setParserTypeUI(Number(initial.parser_type ?? 0)); } catch (_) {}
                  try { initBuiltinModelSelect(initial.builtin_model_id); } catch (_) {}
              } catch (e) {
                  console.error(t('knowledge.error.render_failed') + ':', e);
                  showError(t('knowledge.error.render_failed') + ': ' + e.message);
              }
          }

          // È°ØÁ§∫Âä†ËºâÁãÄÊÖã}

          // ÂÖßÁΩÆÊ®°Âûã‰∏ãÊãâÔºöÂàùÂßãÂåñËàáÊ∏≤Êüì
          function initBuiltinModelSelect(initialModelId) {
            try {
              const container = document.getElementById('kb_builtin_model_select');
              const selected = document.getElementById('kb_builtin_model_selected');
              const nameEl = document.getElementById('kb_builtin_model_selected_name');
              const iconEl = document.getElementById('kb_builtin_model_selected_icon');
              const dropdownEl = document.getElementById('kb_builtin_model_dropdown');
              const hiddenInput = document.getElementById('kb_builtin_model_id');
              if (!container || !selected || !dropdownEl || !hiddenInput) { return; }

              const normalizedInitialId = (initialModelId === undefined || initialModelId === null) ? undefined : String(initialModelId).trim();

              // toggle dropdown
              selected.onclick = function() {
                const isOpen = dropdownEl.style.display !== 'none';
                dropdownEl.style.display = isOpen ? 'none' : 'block';
              };
              document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                  dropdownEl.style.display = 'none';
                }
              });

              dropdownEl.innerHTML = '<div id="kb_builtin_model_loading" style="padding:8px;color:#7b8a8b;">' + t('knowledge.loading.model_list') + '</div>';

              fetch('/api/admin/config/model/list', { method: 'GET' })
                .then(resp => resp.json())
                .then(data => {
                  if (handleApiCode(data)) {
                    return;
                  }
                  const groups = data?.provider_model_list ?? data?.ProviderModelList ?? [];
                  dropdownEl.innerHTML = '';
                  if (!Array.isArray(groups) || groups.length === 0) {
                    dropdownEl.innerHTML = '<div style="padding:8px;color:#bdc3c7;">' + t('knowledge.empty.model_list') + '</div>';
                    return;
                  }

                  let selectedFound = false;

                  groups.forEach(group => {
                    const provider = group.provider ?? group.Provider;
                    const icon = provider?.icon_url ?? provider?.IconURL ?? '';
                    const models = group.model_list ?? group.ModelList ?? [];
                    models.forEach(m => {
                      const id = m.id ?? m.ID;
                      const name = (m.display_info?.name) ?? (m.DisplayInfo?.Name);
                      const opt = document.createElement('div');
                      opt.style.display = 'flex';
                      opt.style.alignItems = 'center';
                      opt.style.gap = '8px';
                      opt.style.padding = '8px';
                      opt.style.cursor = 'pointer';
                      opt.style.borderBottom = '1px solid #f1f3f4';
                      opt.onmouseenter = function(){ opt.style.background = '#f8f9fa'; };
                      opt.onmouseleave = function(){ opt.style.background = '#fff'; };

                      const img = document.createElement('img');
                      img.src = icon || '';
                      img.alt = '';
                      img.style.width = '20px';
                      img.style.height = '20px';
                      img.style.borderRadius = '4px';
                      img.style.objectFit = 'contain';
                      img.style.display = icon ? 'block' : 'none';

                      const span = document.createElement('span');
                      span.textContent = name || t('knowledge.placeholder.model_fallback', { id });

                      opt.appendChild(img);
                      opt.appendChild(span);

                      opt.onclick = function() {
                        hiddenInput.value = String(id);
                        nameEl.textContent = span.textContent;
                        if (icon) { iconEl.src = icon; iconEl.style.display = 'block'; } else { iconEl.style.display = 'none'; }
                        dropdownEl.style.display = 'none';
                      };

                      dropdownEl.appendChild(opt);

                      if (!selectedFound && normalizedInitialId !== undefined && normalizedInitialId !== '' && Number(normalizedInitialId) === Number(id)) {
                        selectedFound = true;
                        hiddenInput.value = String(id);
                        nameEl.textContent = span.textContent;
                        if (icon) { iconEl.src = icon; iconEl.style.display = 'block'; } else { iconEl.style.display = 'none'; }
                      }
                    });
                  });

                  if (!selectedFound) {
                    const first = dropdownEl.firstElementChild;
                    if (first) {
                      first.click();
                    } else {
                      nameEl.textContent = t('knowledge.tip.setup_model_first');
                      iconEl.style.display = 'none';
                    }
                  }
                })
                .catch(err => {
                  dropdownEl.innerHTML = '<div style="padding:8px;color:#e74c3c;">' + t('knowledge.error.model_list_load_failed') + '</div>';
                  console.error(t('knowledge.error.model_list_load_failed') + ':', err);
                });

            } catch (e) {
              console.error('ÂàùÂßãÂåñÂÖßÁΩÆÊ®°Âûã‰∏ãÊãâÂ§±Êïó:', e);
            }
          }

          function buildKnowledgePayloadFromInputs() {
              const val = (id) => {
                  const el = document.getElementById(id);
                  return el ? el.value : '';
              };
              const checked = (id) => {
                  const el = document.getElementById(id);
                  return el ? !!el.checked : false;
              };
              const toNum = (v) => {
                  const n = Number(v);
                  return isNaN(n) ? undefined : n;
              };

              const typeVal = toNum(val('kb_embedding_type'));
              // Ê†πÊìöÈÅ∏ÊìáÁöÑ embedding typeÔºåÊäΩÂèñ base_conn_info Ëàá dims
              const baseConnInfo = (() => {
                  switch (typeVal) {
                      case 0: // Ark
                          return {
                              base_url: val('kb_ark_base_url'),
                              api_key: val('kb_ark_api_key'),
                              model: val('kb_ark_model')
                          };
                      case 1: // OpenAI
                          return {
                              base_url: val('kb_openai_base_url'),
                              api_key: val('kb_openai_api_key'),
                              model: val('kb_openai_model')
                          };
                      case 2: // Ollama
                          return {
                              base_url: val('kb_ollama_base_url'),
                              model: val('kb_ollama_model')
                          };
                      case 3: // Gemini
                          return {
                              base_url: val('kb_gemini_base_url'),
                              api_key: val('kb_gemini_api_key'),
                              model: val('kb_gemini_model')
                          };
                      case 4: // HTTP
                      default:
                          return { base_url: '', api_key: '', model: '' };
                  }
              })();

              const dimsVal = (() => {
                  switch (typeVal) {
                      case 0: return toNum(val('kb_ark_embedding_dims'));
                      case 1: return toNum(val('kb_openai_embedding_dims'));
                      case 2: return toNum(val('kb_ollama_embedding_dims'));
                      case 3: return toNum(val('kb_gemini_embedding_dims'));
                      case 4: return toNum(val('kb_http_dims'));
                      default: return undefined;
                  }
              })();

              return {
                  knowledge_config: {
                      embedding_config: {
                          type: typeVal,
                                  max_batch_size: toNum(val('kb_embedding_max_batch_size')) ?? 100,
                                  connection: {
                              base_conn_info: baseConnInfo,
                              embedding_info: { dims: dimsVal },
                              ark: {
                                  api_type: val('kb_ark_embedding_api_type')
                              },
                              openai: {
                                  by_azure: checked('kb_openai_embedding_by_azure'),
                                  api_version: val('kb_openai_embedding_api_version')
                              },
                              gemini: {
                                  backend: toNum(val('kb_gemini_embedding_backend')),
                                  project: val('kb_gemini_embedding_project'),
                                  location: val('kb_gemini_embedding_location')
                              },
                              http: {
                                  address: val('kb_http_address')
                              }
                          }
                      },
                      rerank_config: {
                          type: toNum(val('kb_rerank_type')),
                          vikingdb_config: {
                              ak: val('kb_vik_ak'),
                              sk: val('kb_vik_sk'),
                              host: val('kb_vik_host'),
                              region: val('kb_vik_region'),
                              model: val('kb_vik_model')
                          }
                      },
                      ocr_config: {
                          type: toNum(val('kb_ocr_type')),
                          volcengine_ak: val('kb_ocr_ark_ak'),
                          volcengine_sk: val('kb_ocr_ark_sk'),
                          paddleocr_api_url: val('kb_ocr_paddleocr_api_url')
                      },
                      parser_config: {
                          type: toNum(val('kb_parser_type')),
                          paddleocr_structure_api_url: val('kb_parser_paddleocr_structure_api_url')
                      },
                      builtin_model_id: toNum(val('kb_builtin_model_id'))
                  }
              };
          }

          function saveKnowledgeConfig() {
              try {
                  const payload = buildKnowledgePayloadFromInputs();
                  // ÂàùÂßãÂåñ Rerank ÈÖçÁΩÆÈ°ØÁ§∫ÁãÄÊÖãÔºàÈò≤Ê≠¢Êú™ÈÅ∏ÊìáÊôÇÈåØË™§Â±ïÁ§∫Ôºâ
                  try { setRerankTypeUI(Number(document.getElementById('kb_rerank_type')?.value || 0)); } catch (_) {}

                  // Embedding ÂøÖÂ°´È†ÖÊ†°È©óÔºà‰∏çÂêåÈ°ûÂûã‰∏çÂêåÂøÖÂ°´Ë¶ÅÊ±ÇÔºâ
                  const typeVal = Number(document.getElementById('kb_embedding_type')?.value);
                  const get = (id) => (document.getElementById(id)?.value || '').trim();
                  const getDims = (id) => {
                      const el = document.getElementById(id);
                      return el ? Number(el.value) : 0;
                  };

                  if (typeVal === 0) {
                      // Ark: Base URL„ÄÅAPI Key„ÄÅModel„ÄÅDims ÂøÖÂ°´ÔºåAPI Type ÂèØÈÅ∏
                      const dimsVal = getDims('kb_ark_embedding_dims');
                      const missing = [];
                      if (!get('kb_ark_base_url')) missing.push('Base URL');
                      if (!get('kb_ark_api_key')) missing.push('API Key');
                      if (!get('kb_ark_model')) missing.push('Model');
                      if (dimsVal < 0) {
                          showError('Dims must be >= 0');
                          return;
                      }
                      
                      if (missing.length > 0) {
                          showError(t('error.missing_required', { list: missing.join(', ') }));
                          return;
                      }
                  } else if (typeVal === 1) {
                      // OpenAI: Base URL„ÄÅModel„ÄÅAPI Key„ÄÅDims ÂøÖÂ°´
                      const dimsVal = getDims('kb_openai_embedding_dims');
                      const missing = [];
                      if (!get('kb_openai_base_url')) missing.push('Base URL');
                      if (!get('kb_openai_model')) missing.push('Model');
                      if (!get('kb_openai_api_key')) missing.push('API Key');
                      if (dimsVal < 0) {
                          showError('Dims must be >= 0');
                          return;
                      }
                      if (missing.length > 0) {
                          showError(t('error.missing_required', { list: missing.join(', ') }));
                          return;
                      }
                  } else if (typeVal === 2) {
                      // Ollama: Base URL„ÄÅModel„ÄÅDims ÂøÖÂ°´
                      const dimsVal = getDims('kb_ollama_embedding_dims');
                      const missing = [];
                      if (!get('kb_ollama_base_url')) missing.push('Base URL');
                      if (!get('kb_ollama_model')) missing.push('Model');
                      if (dimsVal < 0) {
                          showError('Dims must be >= 0');
                          return;
                      }
                      if (missing.length > 0) {
                          showError(t('error.missing_required', { list: missing.join(', ') }));
                          return;
                      }
                  } else if (typeVal === 3) {
                      // Gemini: Base URL„ÄÅAPI Key„ÄÅModel„ÄÅDims„ÄÅBackend ÂøÖÂ°´ÔºõProject„ÄÅLocation ÈÅ∏Â°´
                      const dimsVal = getDims('kb_gemini_embedding_dims');
                      const backendStr = (document.getElementById('kb_gemini_embedding_backend')?.value || '').trim();
                      const missing = [];
                      if (!get('kb_gemini_base_url')) missing.push('Base URL');
                      if (!get('kb_gemini_api_key')) missing.push('API Key');
                      if (!get('kb_gemini_model')) missing.push('Model');
                      if (!backendStr) missing.push('Backend');
                      if (dimsVal < 0) {
                          showError('Dims must be >= 0');
                          return;
                      }
                      if (missing.length > 0) {
                          showError(t('error.missing_required', { list: missing.join(', ') }));
                          return;
                      }
                  } else if (typeVal === 4) {
                      // HTTP: Address„ÄÅDims ÂøÖÂ°´
                      const dimsVal = getDims('kb_http_dims');
                      const missing = [];
                      if (!get('kb_http_address')) missing.push('Address');
                      if (dimsVal < 0) {
                          showError('Dims must be >= 0');
                          return;
                      }
                      if (missing.length > 0) {
                          showError(t('error.missing_required', { list: missing.join(', ') }));
                          return;
                      }
                  }

                  // Rerank ÂøÖÂ°´È†ÖÊ†°È©óÔºöVikingDB ÁöÑ AK„ÄÅSK ÂøÖÂ°´ÔºåÂÖ∂ÂÆÉÈ†ÖÈÅ∏Â°´
                  try {
                      const rerankTypeVal = Number(document.getElementById('kb_rerank_type')?.value);
                      if (rerankTypeVal === 0) {
                          const missing = [];
                          if (!get('kb_vik_ak')) missing.push('AK');
                          if (!get('kb_vik_sk')) missing.push('SK');
                          if (missing.length > 0) {
                              showError(t('error.missing_required', { list: missing.join(', ') }));
                              return;
                          }
                      }
                  } catch (_) {}

                //   showOverlay(t('overlay.saving'));
                  fetch('/api/admin/config/knowledge/save', {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(payload)
                  }).then(async (resp) => {
                      let bodyText = '';
                      try { bodyText = await resp.text(); } catch (_) {}
                      let data = null;
                      try { data = JSON.parse(bodyText); } catch (_) { data = null; }
                      if (data && typeof data === 'object') {
                          if (handleApiCode(data)) { hideOverlay(); return; }
                          if (Number(data.code) === 0) { hideOverlay(); showSuccess(t('success.saved_restart_required')); return; }
                          hideOverlay(); showError(t('error.save_failed_reason', { reason: (data?.msg || t('error.api_error')) })); return;
                      }
                      if (!resp.ok) {
                          hideOverlay();
                          throw new Error(bodyText || ('HTTP ' + resp.status));
                      }
                      hideOverlay();
                      showSuccess(t('success.saved_restart_required'));
                  }).catch((err) => {
                      hideOverlay();
                      console.error('Failed to save knowledge configuration:', err);
                      showError(t('error.save_failed_reason', { reason: (err?.message || String(err)) }));
                  });
              } catch (e) {
                  hideOverlay();
                  console.error('Knowledge configuration save exception:', e);
                  showError(t('error.save_failed_reason', { reason: e.message }));
              }
          }

          function setEmbeddingTypeUI(typeVal) {
              const ids = ['kb_conn_ark','kb_conn_openai','kb_conn_ollama','kb_conn_gemini','kb_conn_http'];
              ids.forEach((id, idx) => {
                  const el = document.getElementById(id);
                  if (el) el.style.display = (Number(typeVal) === idx ? 'block' : 'none');
              });
          }

          function setRerankTypeUI(typeVal) {
              try {
                  const vik = document.getElementById('kb_conn_vikingdb');
                  if (!vik) return;
                  vik.style.display = Number(typeVal) === 0 ? '' : 'none';
              } catch (_) {}
          }
          function onRerankTypeChange() {
              try {
                  const v = Number(document.getElementById('kb_rerank_type')?.value);
                  setRerankTypeUI(v);
              } catch (_) {}
          }

          function setOcrTypeUI(typeVal) {
              try {
                  const volc = document.getElementById('kb_conn_ocr_volcengine');
                  const pad = document.getElementById('kb_conn_ocr_paddleocr');
                  if (!volc || !pad) return;
                  const t = Number(typeVal);
                  volc.style.display = t === 0 ? '' : 'none';
                  pad.style.display = t === 1 ? '' : 'none';
              } catch (_) {}
          }
          function onOcrTypeChange() {
              try {
                  const v = Number(document.getElementById('kb_ocr_type')?.value);
                  setOcrTypeUI(v);
              } catch (_) {}
          }

          function setParserTypeUI(typeVal) {
              try {
                  const pad = document.getElementById('kb_conn_parser_paddleocr');
                  if (!pad) return;
                  pad.style.display = Number(typeVal) === 1 ? '' : 'none';
              } catch (_) {}
          }
          function onParserTypeChange() {
              try {
                  const v = Number(document.getElementById('kb_parser_type')?.value);
                  setParserTypeUI(v);
              } catch (_) {}
          }

          function onEmbeddingTypeChange() {
              const sel = document.getElementById('kb_embedding_type');
              const val = sel ? Number(sel.value) : 0;
              setEmbeddingTypeUI(val);
          }

          function showLoading() {
            pageContent.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <span>${t('loading')}</span>
                </div>
            `;
        }

        // Áµ±‰∏ÄÊàêÂäüÊèêÁ§∫ÔºàÈÄèÊòéÊµÆÂ±§Ôºâ
        function showSuccess(message) {
            showOverlay(message || t('success.generic'), 'success');
        }

        // Áµ±‰∏ÄÈåØË™§ÊèêÁ§∫ÔºàÈÄèÊòéÊµÆÂ±§Ôºâ
        function showError(message) {
            showOverlay(message || t('error.generic'), 'error');
        }

        // ÈÄèÊòéÊµÆÂ±§ÔºöÈ°ØÁ§∫ÔºàËàá config.html ‰øùÊåÅ‰∏ÄËá¥Ôºâ
        function showOverlay(message, type) {
            const overlay = document.getElementById('overlay');
            const overlayContent = document.getElementById('overlayContent');
            const overlayMessage = document.getElementById('overlayMessage');
            if (!overlay || !overlayContent || !overlayMessage) {
                alert(String(message || t('error.generic')));
                return;
            }
            overlayMessage.textContent = String(message || '');
            overlayContent.className = `overlay-content ${type === 'success' ? 'success' : 'error'}`;
            overlay.classList.add('show');
            // ËÉåÊôØÈªûÊìäÈóúÈñâ
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    hideOverlay();
                }
            };
            // 3ÁßíÂæåËá™ÂãïÈö±Ëóè
            setTimeout(() => hideOverlay(), 3000);
        }

        // ÈÄèÊòéÊµÆÂ±§ÔºöÈö±Ëóè
        function hideOverlay() {
            const overlay = document.getElementById('overlay');
            if (overlay) {
                overlay.classList.remove('show');
            }
        }

        // Âä†ËºâÂ§ñÈÉ®È†ÅÈù¢
        function loadPage(filename) {
            showLoading();
            
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(html => {
                    // Ëß£ÊûêHTML‰∏¶ÊèêÂèñÂÖßÂÆπ
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    const title = doc.querySelector('title')?.textContent || t('page.default.title');
                    const content = doc.querySelector('.page-content')?.innerHTML || 
                                  doc.querySelector('body')?.innerHTML || 
                                  `<p>${t('page.empty')}</p>`;
                    
                    pageTitle.textContent = title;
                    pageDescription.textContent = t('page.manage_config', { title });
                    pageContent.innerHTML = content;
                    
                    // Âü∑Ë°åÈ†ÅÈù¢‰∏≠ÁöÑËÖ≥Êú¨
                    const scripts = doc.querySelectorAll('script');
                    scripts.forEach(script => {
                        if (script.textContent) {
                            try {
                                eval(script.textContent);
                            } catch (e) {
                                console.warn('Âü∑Ë°åÈ†ÅÈù¢ËÖ≥Êú¨Â§±Êïó:', e);
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Âä†ËºâÈ†ÅÈù¢Â§±Êïó:', error);
                    showError(t('error.page_load_failed_reason', { reason: error.message }));
                });
        }

        // Âø´ÈÄüÊìç‰ΩúÂáΩÊï∏
        function showSystemStatus() {
            pageContent.innerHTML = `
                <div style="padding: 30px;">
                    <h2 style="margin-bottom: 20px;">üìä Á≥ªÁµ±ÁãÄÊÖã</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
                            <h4 style="color: #28a745; margin: 0 0 10px;">ÊúçÂãôÁãÄÊÖã</h4>
                            <p style="margin: 0; font-size: 24px; font-weight: bold;">üü¢ Ê≠£Â∏∏ÈÅãË°å</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #007bff;">
                            <h4 style="color: #007bff; margin: 0 0 10px;">CPU ‰ΩøÁî®Áéá</h4>
                            <p style="margin: 0; font-size: 24px; font-weight: bold;">23%</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <h4 style="color: #ffc107; margin: 0 0 10px;">ÂÖßÂ≠ò‰ΩøÁî®</h4>
                            <p style="margin: 0; font-size: 24px; font-weight: bold;">1.2GB / 4GB</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                            <h4 style="color: #17a2b8; margin: 0 0 10px;">ÈÅãË°åÊôÇÈñì</h4>
                            <p style="margin: 0; font-size: 24px; font-weight: bold;">7Â§© 12Â∞èÊôÇ</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function showLogs() {
            pageContent.innerHTML = `
                <div style="padding: 30px;">
                    <h2 style="margin-bottom: 20px;">üìù Á≥ªÁµ±Êó•Ë™å</h2>
                    <div style="background: #1e1e1e; color: #00ff00; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; max-height: 400px; overflow-y: auto;">
                        <div>[2024-01-16 10:30:15] INFO: Á≥ªÁµ±ÂïìÂãïÂÆåÊàê</div>
                        <div>[2024-01-16 10:30:16] INFO: Âä†ËºâÈÖçÁΩÆÊñá‰ª∂ÊàêÂäü</div>
                        <div>[2024-01-16 10:30:17] INFO: Êï∏ÊìöÂ∫´ÈÄ£Êé•Âª∫Á´ã</div>
                        <div>[2024-01-16 10:30:18] INFO: API ÊúçÂãôÂïìÂãïÔºåÁ´ØÂè£: 8080</div>
                        <div>[2024-01-16 10:35:22] INFO: Áî®Êà∂ÁôªÈåÑ: admin</div>
                        <div>[2024-01-16 10:36:45] INFO: Ê®°ÂûãÈÖçÁΩÆÊõ¥Êñ∞</div>
                        <div>[2024-01-16 10:38:12] WARN: Áü•Ë≠òÂ∫´Á¥¢ÂºïÈöäÂàóËºÉÈï∑</div>
                        <div>[2024-01-16 10:40:33] INFO: Áü•Ë≠òÂ∫´Á¥¢ÂºïÂÆåÊàê</div>
                    </div>
                </div>
            `;
        }

        function exportConfig() {
            const config = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                settings: {
                    api: { endpoint: "https://api.example.com", timeout: 30000 },
                    models: ["gpt-4", "gpt-3.5-turbo"],
                    knowledge: { maxSize: "10GB", indexing: true }
                }
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'coze-studio-config.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert(t('export.success'));
        }

        function showHelp() {
            pageContent.innerHTML = `
                <div style="padding: 30px;">
                    <h2 style="margin-bottom: 20px;">‚ùì ${t('help.title')}</h2>
                    <div style="display: grid; gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h3 style="color: #667eea; margin-top: 0;">${t('help.quickstart.title')}</h3>
                            <p>1. ${t('help.quickstart.step1')}</p>
                            <p>2. ${t('help.quickstart.step2')}</p>
                            <p>3. ${t('help.quickstart.step3')}</p>
                            <p>4. ${t('help.quickstart.step4')}</p>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h3 style="color: #667eea; margin-top: 0;">${t('help.features.title')}</h3>
                            <p><strong>${t('page.basic.title')}Ôºö</strong>${t('help.features.basic')}</p>
                            <p><strong>${t('page.model.title')}Ôºö</strong>${t('help.features.model')}</p>
                            <p><strong>${t('page.knowledge.title')}Ôºö</strong>${t('help.features.kb')}</p>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h3 style="color: #667eea; margin-top: 0;">${t('help.support.title')}</h3>
                            <p>${t('help.support.contact')}</p>
                            <p>${t('help.support.email', { email: 'support@coze-studio.com' })}</p>
                            <p>${t('help.support.phone', { phone: '400-123-4567' })}</p>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>